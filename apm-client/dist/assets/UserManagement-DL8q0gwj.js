import{j as e,m as Q}from"./ui-BlmhFX_F.js";import{r as o}from"./router-DFnE1L-t.js";import{u as Z,a as O,b as W,c as Y,d as q,e as z}from"./adminApi-DifUUFDz.js";import{u as J}from"./index-P8gjH_om.js";import{b as K}from"./api-IvBNLaH7.js";import{F as j}from"./XCircleIcon-CvFATmWB.js";import{F as X}from"./ClockIcon-DZUckIFe.js";import{F as S}from"./CheckCircleIcon-DCBCeWMH.js";import{F as v}from"./UserIcon-rexTD0xK.js";import{F as ee}from"./MagnifyingGlassIcon-C2UCCqkW.js";import{F as re}from"./ChevronLeftIcon-D6giPwF6.js";import{F as te}from"./ChevronRightIcon-CdFql2QB.js";import"./redux-VN59sPcb.js";import"./vendor-gH-7aFTg.js";import"./utils-CXyNmL__.js";function ae({title:d,titleId:c,...x},i){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":c},x),d?o.createElement("title",{id:c},d):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m0-10.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.75c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.57-.598-3.75h-.152c-3.196 0-6.1-1.25-8.25-3.286Zm0 13.036h.008v.008H12v-.008Z"}))}const se=o.forwardRef(ae),le=d=>{const c={email_pending:{text:"Email Pending",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400"},email_verified:{text:"Email Verified",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400"},alumni_verified:{text:"Alumni Verified",color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400"},rejected:{text:"Rejected",color:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"}},x=c[d]||c.email_pending;return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x.color}`,children:x.text})},Ue=()=>{const{user:d}=J(),[c,x]=o.useState(1),[i,m]=o.useState([]),[de,ie]=o.useState(!1),[ne,oe]=o.useState(null),[l,b]=o.useState({search:"",batch:"",status:"all",role:"all"}),{data:y,isLoading:U,error:A,refetch:g}=Z({page:c,limit:20,search:l.search||void 0,batch:l.batch?parseInt(l.batch):void 0,status:l.status!=="all"?l.status:void 0,role:l.role!=="all"?l.role:void 0}),{data:R,isLoading:_,error:F}=O({timeframe:30}),[M,{isLoading:k}]=W(),[C,{isLoading:E}]=Y(),[D,{isLoading:B}]=q(),[P,{isLoading:N}]=z(),w=async(r,t)=>{const a=h?.find(p=>p.id===r),n=a?.fullName||"this user",G=a?.role||"USER",f={USER:"Regular User",BATCH_ADMIN:"Batch Admin",SUPER_ADMIN:"Super Admin"};if(confirm(`Are you sure you want to change ${n}'s role from "${f[G]}" to "${f[t]}"?

This action will:
- Update their permissions immediately
- Send them a notification about the role change
- Cannot be undone without another manual change`))try{await M({userId:r,role:t}).unwrap(),g(),alert(`✅ Successfully updated ${n}'s role to ${f[t]}`)}catch(p){console.error("Failed to update user role:",p),alert(`❌ Failed to update user role: ${p?.data?.message||"Unknown error"}`)}},$=async(r,t)=>{try{await C({userId:r,notes:t}).unwrap(),g(),m(a=>a.filter(n=>n!==r))}catch(a){console.error("Failed to verify user:",a)}},L=async(r,t)=>{try{await D({userId:r,reason:t}).unwrap(),g(),m(a=>a.filter(n=>n!==r))}catch(a){console.error("Failed to reject user:",a)}},V=async(r,t)=>{try{if(!confirm(`Are you sure you want to unblock ${t}? This will remove them from the blacklist and reset their verification status to pending.`))return;const a=await K.post(`/admin/verification/users/${r}/unblock`,{reason:"Admin decided to unblock user for re-verification"});a.data.success?(g(),alert("✅ User has been unblocked successfully! They have been removed from blacklist and reset to pending verification. Admin can now approve or reject them again.")):(console.error("Failed to unblock user:",a.data),alert(`❌ Failed to unblock user: ${a.data.message||"Unknown error"}`))}catch(a){console.error("Failed to unblock user:",a);const n=a?.response?.data?.message||"Failed to unblock user";alert(`❌ ${n}`)}},I=async()=>{if(i.length!==0)try{await P({userIds:i,notes:"Bulk verification by admin"}).unwrap(),g(),m([])}catch(r){console.error("Failed to bulk verify users:",r)}},T=r=>{const t=h.find(a=>a.id===r);t&&t.userStatus==="email_verified"&&m(a=>a.includes(r)?a.filter(n=>n!==r):[...a,r])},H=()=>{const t=(y?.users||[]).filter(a=>a.userStatus==="email_verified");i.length===t.length&&t.length>0?m([]):m(t.map(a=>a.id))};if(U||_)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[...Array(4)].map((r,t)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]},t))}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-4"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((r,t)=>e.jsx("div",{className:"h-16 bg-gray-200 dark:bg-gray-700 rounded"},t))})]})]})});if(A)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-6 w-6 text-red-600 dark:text-red-400 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-800 dark:text-red-300",children:"Failed to load user data"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mt-1",children:"Please check your connection and try again."})]})]}),e.jsx("button",{onClick:()=>g(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Retry"})]})});const h=y?.users||[],s=y?.pagination,u=R;return e.jsxs("div",{className:"p-6 space-y-8 overflow-visible",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"User Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage all user accounts, roles, and verification status"})]})}),u&&!F&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 sm:p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-6 w-6 sm:h-8 sm:w-8 text-yellow-600 dark:text-yellow-400"}),e.jsxs("div",{className:"ml-2 sm:ml-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Pending"}),e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-white",children:u?.pending?.total?.toLocaleString()||0})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 sm:p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-6 w-6 sm:h-8 sm:w-8 text-green-600 dark:text-green-400"}),e.jsxs("div",{className:"ml-2 sm:ml-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Approved"}),e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-white",children:u?.processed?.approved?.toLocaleString()||0})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 sm:p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-6 w-6 sm:h-8 sm:w-8 text-red-600 dark:text-red-400"}),e.jsxs("div",{className:"ml-2 sm:ml-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Rejected"}),e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-white",children:u?.processed?.rejected?.toLocaleString()||0})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 sm:p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{className:"ml-2 sm:ml-4",children:[e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Total"}),e.jsx("p",{className:"text-lg sm:text-2xl font-bold text-gray-900 dark:text-white",children:u?.processed?.total?.toLocaleString()||0})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 sm:p-6 border border-gray-200 dark:border-gray-700 overflow-visible",children:[e.jsxs("div",{className:"space-y-4 overflow-visible",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:l.search,onChange:r=>b(t=>({...t,search:r.target.value})),className:"pl-10 pr-4 py-3 w-full border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 overflow-visible relative",children:[e.jsxs("select",{value:l.batch,onChange:r=>b(t=>({...t,batch:r.target.value})),className:"px-3 py-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"",children:"All Batches"}),Array.from({length:10},(r,t)=>new Date().getFullYear()-t).map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsxs("select",{value:l.status,onChange:r=>b(t=>({...t,status:r.target.value})),className:"px-3 py-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"email_pending",children:"Email Pending"}),e.jsx("option",{value:"email_verified",children:"Email Verified"}),e.jsx("option",{value:"alumni_verified",children:"Alumni Verified"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsxs("select",{value:l.role,onChange:r=>b(t=>({...t,role:r.target.value})),className:"px-3 py-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"BATCH_ADMIN",children:"Batch Admin"}),e.jsx("option",{value:"SUPER_ADMIN",children:"Super Admin"})]})]})]}),i.length>0&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-blue-800 dark:text-blue-300",children:[i.length," user",i.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:I,disabled:N,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:opacity-50",children:N?"Verifying...":"Bulk Verify"}),e.jsx("button",{onClick:()=>m([]),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"Clear Selection"})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:h.filter(r=>r.userStatus==="email_verified").length>0&&i.length===h.filter(r=>r.userStatus==="email_verified").length,onChange:H,className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"})}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),e.jsx("th",{className:"hidden sm:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"hidden md:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Registered"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"hidden lg:table-cell px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(v,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No users found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No users match the current filter criteria."})]})})}):h.map(r=>e.jsxs(Q.tr,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-3 sm:px-6 py-4",children:e.jsx("input",{type:"checkbox",checked:i.includes(r.id),onChange:()=>T(r.id),disabled:r.userStatus!=="email_verified",className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"})}),e.jsx("td",{className:"px-3 sm:px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 sm:h-10 w-8 sm:w-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx(v,{className:"h-4 sm:h-6 w-4 sm:w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"ml-2 sm:ml-4 min-w-0 flex-1",children:[e.jsx("div",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-white truncate",children:r.fullName}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:r.email}),e.jsxs("div",{className:"sm:hidden text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Batch ",r.batch," • ",new Date(r.registeredAt).toLocaleDateString()]}),d?.role==="SUPER_ADMIN"&&e.jsx("div",{className:"lg:hidden mt-2",children:e.jsxs("select",{value:r.role,onChange:t=>w(r.id,t.target.value),disabled:r.userStatus!=="alumni_verified"||k,className:"text-xs px-2 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"BATCH_ADMIN",children:"Batch Admin"}),e.jsx("option",{value:"SUPER_ADMIN",children:"Super Admin"})]})}),d?.role==="BATCH_ADMIN"&&e.jsxs("div",{className:"lg:hidden mt-2 text-xs text-gray-600 dark:text-gray-400",children:["Role: ",r.role.replace("_"," ")]})]})]})}),e.jsx("td",{className:"hidden sm:table-cell px-6 py-4 text-sm text-gray-900 dark:text-white",children:r.batch}),e.jsx("td",{className:"hidden md:table-cell px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:new Date(r.registeredAt).toLocaleDateString()}),e.jsx("td",{className:"px-3 sm:px-6 py-4",children:le(r.userStatus)}),e.jsx("td",{className:"hidden lg:table-cell px-6 py-4",children:d?.role==="SUPER_ADMIN"?e.jsxs("select",{value:r.role,onChange:t=>w(r.id,t.target.value),disabled:r.userStatus!=="alumni_verified"||k,className:"text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"USER",children:"User"}),e.jsx("option",{value:"BATCH_ADMIN",children:"Batch Admin"}),e.jsx("option",{value:"SUPER_ADMIN",children:"Super Admin"})]}):e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:r.role.replace("_"," ")})}),e.jsx("td",{className:"px-3 sm:px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[r.userStatus==="email_verified"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>$(r.id),disabled:E,className:"p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-md disabled:opacity-50",title:"Approve Alumni Verification",children:e.jsx(S,{className:"h-4 w-4"})}),d?.role==="SUPER_ADMIN"&&e.jsx("button",{onClick:()=>L(r.id,"Manual rejection"),disabled:B,className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md disabled:opacity-50",title:"Reject Alumni Verification",children:e.jsx(j,{className:"h-4 w-4"})})]}),r.userStatus==="rejected"&&d?.role==="SUPER_ADMIN"&&e.jsx("button",{onClick:()=>V(r.id,r.email),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md",title:"Unblock User (Remove from Blacklist)",children:e.jsx(se,{className:"h-4 w-4"})})]})})]},r.id))})]})}),s&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 px-6 py-3 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center text-sm text-gray-700 dark:text-gray-300",children:e.jsxs("span",{children:["Showing ",(s.page-1)*s.limit+1," to"," ",Math.min(s.page*s.limit,s.total)," of"," ",s.total," results"]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>x(r=>Math.max(1,r-1)),disabled:s.page<=1,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-md disabled:opacity-50",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",s.page," of ",s.totalPages]}),e.jsx("button",{onClick:()=>x(r=>Math.min(s.totalPages,r+1)),disabled:s.page>=s.totalPages,className:"p-2 text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-md disabled:opacity-50",children:e.jsx(te,{className:"h-5 w-5"})})]})]})]})]})};export{Ue as default};
//# sourceMappingURL=UserManagement-DL8q0gwj.js.map
