{"version":3,"file":"api-CtsDlLFZ.js","sources":["../../src/services/api.ts"],"sourcesContent":["// src/services/api.ts\nimport axios, { AxiosResponse, AxiosError } from 'axios';\nimport { store } from '@/store';\nimport { logout } from '@/store/slices/authSlice';\n\n// Detect if we're running in Capacitor (mobile) vs web\nconst isCapacitor = typeof window !== 'undefined' && \n  (window as any).Capacitor && \n  (window as any).Capacitor.isNativePlatform();\n\n// Use different API URLs based on environment\nconst getApiBaseUrl = () => {\n  if (isCapacitor) {\n    // Mobile app - use Android emulator localhost address\n    return 'http://10.0.2.2:3000/api';\n  } else {\n    // Desktop web - use regular localhost\n    return import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api';\n  }\n};\n\nconst API_BASE_URL = getApiBaseUrl();\n\n// Create axios instance\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n  withCredentials: true,\n  timeout: 10000, // 10 seconds timeout\n});\n\n// Request interceptor to add auth token\napi.interceptors.request.use(\n  (config) => {\n    const state = store.getState();\n    const token = state.auth.token;\n    \n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    \n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\n\n// Response interceptor to handle errors\napi.interceptors.response.use(\n  (response: AxiosResponse) => {\n    return response;\n  },\n  (error: AxiosError) => {\n    // Handle 401 errors (unauthorized)\n    if (error.response?.status === 401) {\n      // Check if it's not a login or register request\n      const isAuthRequest = error.config?.url?.includes('/auth/login') || \n                           error.config?.url?.includes('/auth/register');\n      \n      if (!isAuthRequest) {\n        // Token is invalid, logout user\n        store.dispatch(logout());\n        window.location.href = '/auth/login';\n      }\n    }\n    \n    // Handle network errors\n    if (!error.response) {\n      error.message = 'Network error - please check your connection';\n    }\n    \n    return Promise.reject(error);\n  }\n);\n\n// Utility functions for different HTTP methods\nexport const apiClient = {\n  get: <T = unknown>(url: string, config?: any) => \n    api.get<T>(url, config),\n    \n  post: <T = unknown>(url: string, data?: any, config?: any) => \n    api.post<T>(url, data, config),\n    \n  put: <T = unknown>(url: string, data?: any, config?: any) => \n    api.put<T>(url, data, config),\n    \n  patch: <T = unknown>(url: string, data?: any, config?: any) => \n    api.patch<T>(url, data, config),\n    \n  delete: <T = unknown>(url: string, config?: any) => \n    api.delete<T>(url, config),\n    \n  // Special method for file uploads\n  postFormData: <T = unknown>(url: string, formData: FormData, config?: any) => \n    api.post<T>(url, formData, {\n      ...config,\n      headers: {\n        'Content-Type': 'multipart/form-data',\n        ...config?.headers,\n      },\n    }),\n};\n\n// Export as both named and default for compatibility\nexport { api };\nexport default api;"],"names":["isCapacitor","getApiBaseUrl","API_BASE_URL","api","axios","config","token","store","error","response","logout","apiClient","url","data","formData"],"mappings":"uFAMA,MAAMA,EAAc,OAAO,OAAW,KACnC,OAAe,WACf,OAAe,UAAU,iBAAA,EAGtBC,EAAgB,IAChBD,EAEK,2BAGA,4BAILE,EAAeD,EAAA,EAGfE,EAAMC,EAAM,OAAO,CACvB,QAASF,EACT,QAAS,CACP,eAAgB,kBAAA,EAElB,gBAAiB,GACjB,QAAS,GACX,CAAC,EAGDC,EAAI,aAAa,QAAQ,IACtBE,GAAW,CAEV,MAAMC,EADQC,EAAM,SAAA,EACA,KAAK,MAEzB,OAAID,IACFD,EAAO,QAAQ,cAAgB,UAAUC,CAAK,IAGzCD,CACT,EACCG,GACQ,QAAQ,OAAOA,CAAK,CAE/B,EAGAL,EAAI,aAAa,SAAS,IACvBM,GACQA,EAERD,IAEKA,EAAM,UAAU,SAAW,MAEPA,EAAM,QAAQ,KAAK,SAAS,aAAa,GAC1CA,EAAM,QAAQ,KAAK,SAAS,gBAAgB,IAI/DD,EAAM,SAASG,GAAQ,EACvB,OAAO,SAAS,KAAO,gBAKtBF,EAAM,WACTA,EAAM,QAAU,gDAGX,QAAQ,OAAOA,CAAK,EAE/B,EAGO,MAAMG,EAAY,CACvB,IAAK,CAAcC,EAAaP,IAC9BF,EAAI,IAAOS,EAAKP,CAAM,EAExB,KAAM,CAAcO,EAAaC,EAAYR,IAC3CF,EAAI,KAAQS,EAAKC,EAAMR,CAAM,EAE/B,IAAK,CAAcO,EAAaC,EAAYR,IAC1CF,EAAI,IAAOS,EAAKC,EAAMR,CAAM,EAE9B,MAAO,CAAcO,EAAaC,EAAYR,IAC5CF,EAAI,MAASS,EAAKC,EAAMR,CAAM,EAEhC,OAAQ,CAAcO,EAAaP,IACjCF,EAAI,OAAUS,EAAKP,CAAM,EAG3B,aAAc,CAAcO,EAAaE,EAAoBT,IAC3DF,EAAI,KAAQS,EAAKE,EAAU,CACzB,GAAGT,EACH,QAAS,CACP,eAAgB,sBAChB,GAAGA,GAAQ,OAAA,CACb,CACD,CACL"}