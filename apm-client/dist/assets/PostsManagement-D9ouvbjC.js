import{j as e,A as H,m as k}from"./ui-BlmhFX_F.js";import{r as n}from"./router-DFnE1L-t.js";import{C as U}from"./redux-VN59sPcb.js";import{P as Z,F as g,a as V,b as G,c as W,u as N,d as _}from"./PostImageDisplay-Fz7qO6qV.js";import{B as i,C as X}from"./CreatePostModal-CClIB8FO.js";import{F as q}from"./XMarkIcon-D1c1wIzV.js";import{F as J}from"./UserIcon-rexTD0xK.js";import{F as R}from"./CalendarIcon-CroBm0p_.js";import{F as M}from"./XCircleIcon-CvFATmWB.js";import{F as y}from"./CheckCircleIcon-DCBCeWMH.js";import{F as S}from"./TrashIcon-mpSEd7uz.js";import{a as L}from"./utils-CXyNmL__.js";import{L as K}from"./LoadingSpinner-BR8iBbEe.js";import{c as $,z as h}from"./index-DHymdRDT.js";import{F as Y}from"./PlusIcon-B6tiF6Nj.js";import{F as ee}from"./MagnifyingGlassIcon-C2UCCqkW.js";import{F as ae}from"./EyeIcon-Bt_hkgUK.js";import{F as se}from"./ClockIcon-DZUckIFe.js";import"./vendor-gH-7aFTg.js";import"./PhotoIcon-n1eOvNeY.js";import"./ChevronLeftIcon-D6giPwF6.js";import"./ChevronRightIcon-CdFql2QB.js";import"./index.esm-B0I9BSpA.js";import"./index.esm-kU_tS0bV.js";import"./userApi-D_lJxXui.js";function te({title:s,titleId:t,...o},c){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":t},o),s?n.createElement("title",{id:t},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}const re=n.forwardRef(te);function ie({title:s,titleId:t,...o},c){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":t},o),s?n.createElement("title",{id:t},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 6h.008v.008H6V6Z"}))}const le=n.forwardRef(ie),ne=({post:s,isOpen:t,onClose:o,onApprove:c,onArchive:m,onDelete:u})=>{const p=x=>x.isArchived?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-300",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Archived"]}):x.isPublished?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300",children:[e.jsx(y,{className:"h-3 w-3 mr-1"}),"Published"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-300",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Pending Review"]});return e.jsx(H,{children:t&&s&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50",onClick:o}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"relative w-full max-w-4xl bg-white dark:bg-gray-800 rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Post Details"}),p(s)]}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(q,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),s.author.fullName,s.author.batch&&` (Batch ${s.author.batch})`]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),L(new Date(s.createdAt),{addSuffix:!0})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),s.category]})]})]}),(s.heroImage||s.images&&s.images.length>0)&&e.jsx(Z,{postId:s.id,heroImage:s.heroImage,images:s.images||[],title:s.title}),e.jsx("div",{className:"prose prose-gray dark:prose-invert max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap text-gray-700 dark:text-gray-300",children:s.body})}),s.tags&&s.tags.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:"Tagged Users"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((x,f)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-300",children:["@",x]},f))})]}),e.jsxs("div",{className:"flex items-center space-x-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"mr-2",children:"ðŸ‘"}),e.jsxs("span",{children:[s.totalReactions||s.likeCount||0," reactions"]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"mr-2",children:"ðŸ’¬"}),e.jsxs("span",{children:[s._count?.comments||0," comments"]})]}),s.allowComments&&e.jsx("span",{className:"text-green-600 dark:text-green-400 text-sm",children:"Comments enabled"}),s.allowLikes&&e.jsx("span",{className:"text-green-600 dark:text-green-400 text-sm",children:"Reactions enabled"})]})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(i,{variant:"outline",onClick:o,children:"Close"}),!s.isPublished&&c&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"danger",onClick:()=>c(s.id,!1),className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"Reject"})]}),e.jsxs(i,{variant:"primary",onClick:()=>c(s.id,!0),className:"flex items-center space-x-2",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Approve"})]})]}),!s.isArchived&&s.isPublished&&m&&e.jsxs(i,{variant:"outline",onClick:()=>m(s.id),className:"flex items-center space-x-2",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{children:"Archive"})]}),u&&e.jsxs(i,{variant:"danger",onClick:()=>u(s.id),className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{children:"Delete"})]})]})]})})]})})},Le=()=>{const{user:s}=U(a=>a.auth),[t,o]=n.useState("pending"),[c,m]=n.useState({page:1,limit:20,sortBy:"createdAt",sortOrder:"desc"}),[u,p]=n.useState(!1),[x,f]=n.useState(""),[j,P]=n.useState(null),[z]=V(),[B]=G(),[O]=W(),D=N({...c,isPublished:t==="published"?!0:void 0,isArchived:t==="archived"?!0:t==="published"?!1:void 0,search:x||void 0},{pollingInterval:3e4,refetchOnFocus:!0,refetchOnReconnect:!0}),C=_({page:c.page,limit:c.limit},{pollingInterval:15e3,refetchOnFocus:!0,refetchOnReconnect:!0}),l=t==="pending"?C:D,F=l.data?.posts||[],v=async(a,r)=>{try{await z({postId:a,approved:r}).unwrap(),h.success(r?"Post approved successfully":"Post rejected successfully")}catch(d){console.error("Failed to update post approval:",d),h.error(d?.data?.message||"Failed to update post approval")}},A=async a=>{if(window.confirm("Are you sure you want to delete this post? This action cannot be undone."))try{await B(a).unwrap(),h.success("Post deleted successfully")}catch(r){console.error("Failed to delete post:",r),h.error(r?.data?.message||"Failed to delete post")}},w=async(a,r=!0)=>{try{await O({postId:a,isArchived:r}).unwrap(),h.success(`Post ${r?"archived":"unarchived"} successfully`)}catch(d){console.error(`Failed to ${r?"archive":"unarchive"} post:`,d),h.error(d?.data?.message||`Failed to ${r?"archive":"unarchive"} post`)}},E=a=>a.isArchived?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Archived"]}):a.isPublished?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(y,{className:"h-3 w-3 mr-1"}),"Published"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),"Pending Review"]}),I=N({page:1,limit:1,isPublished:!0,isArchived:!1}),Q=N({page:1,limit:1,isArchived:!0}),T=[{key:"pending",label:"Pending Approval",count:C.data?.pagination?.total||0},{key:"published",label:"Published",count:I.data?.pagination?.total||0},{key:"archived",label:"Archived",count:Q.data?.pagination?.total||0}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Posts Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage and moderate community posts"})]}),e.jsxs(i,{onClick:()=>p(!0),className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-5 w-5"}),e.jsx("span",{children:"Create Post"})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsx("nav",{className:"flex space-x-8",children:T.map(a=>e.jsxs("button",{onClick:()=>o(a.key),className:`py-2 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 ${t===a.key?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("span",{children:a.label}),e.jsx("span",{className:`inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none rounded-full ${t===a.key?"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"}`,children:a.count})]},a.key))})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:x,onChange:a=>f(a.target.value),placeholder:"Search posts...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx(ee,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 absolute left-3 top-1/2 transform -translate-y-1/2"})]}),e.jsxs("select",{value:`${c.sortBy}:${c.sortOrder}`,onChange:a=>{const[r,d]=a.target.value.split(":");m(b=>({...b,sortBy:r,sortOrder:d}))},className:"border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"createdAt:desc",children:"Newest First"}),e.jsx("option",{value:"createdAt:asc",children:"Oldest First"}),e.jsx("option",{value:"title:asc",children:"Title A-Z"}),e.jsx("option",{value:"title:desc",children:"Title Z-A"}),e.jsx("option",{value:"totalReactions:desc",children:"Most Reacted"}),e.jsx("option",{value:"viewCount:desc",children:"Most Viewed"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:l.isLoading?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(K,{size:"lg"})}):l.error?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 mb-4",children:"Failed to load posts"}),e.jsx(i,{onClick:()=>l.refetch(),children:"Retry"})]}):F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 mb-4",children:t==="pending"?"No posts pending approval":t==="archived"?"No archived posts available":"No posts found"}),t==="published"&&e.jsx(i,{onClick:()=>p(!0),children:"Create your first post"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Post"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Author"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Stats"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:F.map(a=>e.jsxs(k.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[a.heroImage&&e.jsx("img",{src:$(`/api/posts/${a.id}/hero-image`),alt:a.title,className:"h-10 w-10 rounded object-cover mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white max-w-xs truncate",children:a.title}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:a.category?.toLowerCase()})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 rounded-full mr-2 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-xs",children:a.author.profileImage?e.jsx("img",{src:$(`/api/users/profile-picture/${a.author.id}`),alt:a.author.fullName,className:"h-full w-full object-cover rounded-full",onError:r=>{const d=r.target;d.style.display="none",d.parentElement.innerHTML=a.author.fullName.split(" ").map(b=>b.charAt(0)).join("").slice(0,2).toUpperCase()}}):a.author.fullName.split(" ").map(r=>r.charAt(0)).join("").slice(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.author.fullName}),a.author.batch&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Batch ",a.author.batch]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:E(a)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"ðŸ‘"}),e.jsx("span",{children:a.totalReactions||a.likeCount||0})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"ðŸ’¬"}),e.jsx("span",{children:a._count?.comments||0})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:L(new Date(a.createdAt),{addSuffix:!0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>P(a),className:"flex items-center space-x-1 px-3 py-2",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline whitespace-nowrap",children:"View"})]}),!a.isPublished&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{size:"sm",variant:"primary",onClick:()=>v(a.id,!0),className:"flex items-center space-x-1 px-3 py-2",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline whitespace-nowrap",children:"Approve"})]}),e.jsxs(i,{size:"sm",variant:"danger",onClick:()=>v(a.id,!1),className:"flex items-center space-x-1 px-3 py-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline whitespace-nowrap",children:"Reject"})]})]}),!a.isArchived&&a.isPublished&&e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>w(a.id,!0),className:"flex items-center space-x-1 px-3 py-2",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline whitespace-nowrap",children:"Archive"})]}),a.isArchived&&e.jsxs(i,{size:"sm",variant:"primary",onClick:()=>w(a.id,!1),className:"flex items-center space-x-1 px-3 py-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline whitespace-nowrap",children:"Unarchive"})]}),e.jsxs(i,{size:"sm",variant:"danger",onClick:()=>A(a.id),className:"flex items-center space-x-1 px-3 py-2",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline whitespace-nowrap",children:"Delete"})]})]})})]},a.id))})]})}),l.data?.pagination&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",(l.data.pagination.page-1)*l.data.pagination.limit+1," to"," ",Math.min(l.data.pagination.page*l.data.pagination.limit,l.data.pagination.total)," ","of ",l.data.pagination.total," results"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{size:"sm",variant:"outline",disabled:!l.data.pagination.hasPrev,onClick:()=>m(a=>({...a,page:a.page-1})),children:"Previous"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Page ",l.data.pagination.page," of ",l.data.pagination.pages]}),e.jsx(i,{size:"sm",variant:"outline",disabled:!l.data.pagination.hasNext,onClick:()=>m(a=>({...a,page:a.page+1})),children:"Next"})]})]})})]})}),e.jsx(X,{isOpen:u,onClose:()=>p(!1)}),e.jsx(ne,{post:j,isOpen:!!j,onClose:()=>P(null),onApprove:v,onArchive:a=>w(a,!j?.isArchived),onDelete:A})]})};export{Le as default};
//# sourceMappingURL=PostsManagement-D9ouvbjC.js.map
