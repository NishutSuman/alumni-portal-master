import{j as e,A as Q,m as G}from"./ui-BlmhFX_F.js";import{r as s,R as V}from"./router-DFnE1L-t.js";import{C as B}from"./redux-VN59sPcb.js";import{b as W,c as Y,u as q}from"./PostImageDisplay-Fz7qO6qV.js";import{B as y,P as E,a as L,C as J}from"./CreatePostModal-CClIB8FO.js";import{P as K}from"./PostCard-xetW218i.js";import{L as O}from"./LoadingSpinner-BR8iBbEe.js";import{z as f}from"./index-DHymdRDT.js";import{F as X}from"./PlusIcon-B6tiF6Nj.js";import{F as R}from"./MagnifyingGlassIcon-C2UCCqkW.js";import"./vendor-gH-7aFTg.js";import"./PhotoIcon-n1eOvNeY.js";import"./XMarkIcon-D1c1wIzV.js";import"./ChevronLeftIcon-D6giPwF6.js";import"./ChevronRightIcon-CdFql2QB.js";import"./index.esm-B0I9BSpA.js";import"./index.esm-kU_tS0bV.js";import"./userApi-D_lJxXui.js";import"./TrashIcon-mpSEd7uz.js";import"./utils-CXyNmL__.js";import"./PencilIcon-DAEDOf0J.js";import"./EllipsisVerticalIcon-CJAxHUn0.js";import"./CheckCircleIcon-DCBCeWMH.js";import"./XCircleIcon-CvFATmWB.js";import"./ClockIcon-DZUckIFe.js";function Z({title:l,titleId:t,...d},h){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":t},d),l?s.createElement("title",{id:t},l):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"}))}const ee=s.forwardRef(Z),M=({filters:l,onFiltersChange:t,onClearSearch:d,className:h=""})=>{const{user:u}=B(o=>o.auth),v=u?.role==="SUPER_ADMIN";return e.jsxs("div",{className:`space-y-4 ${h}`,children:[v&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Publication Status"}),e.jsxs("select",{value:l.isPublished===void 0?"ALL":l.isPublished?"PUBLISHED":"UNPUBLISHED",onChange:o=>{const m=o.target.value;t({isPublished:m==="ALL"?void 0:m==="PUBLISHED"})},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ALL",children:"All Posts"}),e.jsx("option",{value:"PUBLISHED",children:"Published"}),e.jsx("option",{value:"UNPUBLISHED",children:"Unpublished"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date Range"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"date",value:l.dateFrom||"",onChange:o=>t({dateFrom:o.target.value||void 0}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"From date"}),e.jsx("input",{type:"date",value:l.dateTo||"",onChange:o=>t({dateTo:o.target.value||void 0}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"To date"})]})]}),e.jsx("button",{onClick:()=>{t({isPublished:!0,isArchived:!1,category:void 0,dateFrom:void 0,dateTo:void 0,tags:void 0,author:void 0}),d?.()},className:"w-full px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition-colors",children:"Clear All Filters"})]})},Pe=()=>{const{user:l}=B(r=>r.auth),[t,d]=s.useState({page:1,limit:10,isPublished:!0,isArchived:!1,sortBy:"createdAt",sortOrder:"desc"}),[h,u]=s.useState(!1),[v,o]=s.useState(null),[m,j]=s.useState(!1),[i,g]=s.useState(""),b=s.useRef(),N=s.useRef(!0),[I]=W(),[T]=Y(),{data:C,isLoading:p,isFetching:k,error:P,refetch:D}=q(t,{pollingInterval:0,refetchOnFocus:!1,refetchOnReconnect:!0,refetchOnMountOrArgChange:!1,skip:!1,keepUnusedDataFor:300}),n=C?.posts||[],w=C?.pagination?.hasNext||!1,U=s.useCallback(r=>{p||k||(b.current&&b.current.disconnect(),b.current=new IntersectionObserver(a=>{a[0].isIntersecting&&w&&d(c=>({...c,page:c.page+1}))}),r&&b.current.observe(r))},[p,k,w]),x=r=>{d(a=>({...a,...r,page:1}))},S=()=>{g("")};V.useEffect(()=>{if(N.current){N.current=!1;return}if(i.trim()){const r=setTimeout(()=>{d(a=>({...a,page:1,search:i.trim()}))},500);return()=>clearTimeout(r)}else d(r=>({...r,page:1,search:void 0}))},[i]);const F=r=>{const[a,c]=r.split(":");x({sortBy:a,sortOrder:c})},H=r=>{o(r),u(!0)},$=async r=>{if(window.confirm("Are you sure you want to delete this post? This action cannot be undone."))try{await I(r).unwrap(),f.success("Post deleted successfully")}catch(a){console.error("Failed to delete post:",a);const c=a?.data?.message||"Failed to delete post";f.error(c)}},z=async r=>{if(window.confirm("Are you sure you want to archive this post?"))try{await T(r).unwrap(),f.success("Post archived successfully")}catch(a){console.error("Failed to archive post:",a);const c=a?.data?.message||"Failed to archive post";f.error(c)}},_=()=>{u(!1),o(null)},A=l?.isAlumniVerified&&!l?.isBlacklisted;return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"flex-shrink-0 bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Posts"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Connect and share with the community"})]}),A&&e.jsxs(y,{onClick:()=>u(!0),className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("span",{children:"Create Post"})]})]})})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 h-full",children:[e.jsx("div",{className:"lg:hidden mb-4",children:e.jsxs(y,{variant:"outline",onClick:()=>j(!m),className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Filters"})]})}),e.jsxs("div",{className:"flex gap-6 h-full",children:[e.jsx("div",{className:"w-80 flex-shrink-0 hidden lg:block",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 sticky top-0",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Filters"})}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:r=>g(r.target.value),placeholder:"Search by title or author...",className:"w-full pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx(R,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 absolute left-3 top-1/2 transform -translate-y-1/2"}),i&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Clear search",children:"✕"})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort by"}),e.jsx("select",{value:`${t.sortBy}:${t.sortOrder}`,onChange:r=>F(r.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:E.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),e.jsxs("select",{value:t.category||"",onChange:r=>x({category:r.target.value||void 0}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Categories"}),L.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]})]}),e.jsx(M,{filters:t,onFiltersChange:x,onClearSearch:S,className:"block"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto h-full",children:[p&&n.length===0&&e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(O,{size:"lg"})}),P&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 mb-4",children:"Failed to load posts. Please try again."}),e.jsx(y,{onClick:()=>D(),children:"Retry"})]}),n&&n.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{mode:"popLayout",children:n.map((r,a)=>e.jsx(G.div,{ref:a===n.length-1?U:null,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,delay:a*.05},children:e.jsx(K,{post:r,onEdit:H,onDelete:$,onArchive:z})},r.id))}),k&&e.jsx("div",{className:"flex justify-center py-6",children:e.jsx(O,{})}),!w&&n.length>0&&e.jsx("div",{className:"text-center py-6 text-gray-500 dark:text-gray-400",children:"You've reached the end of posts"})]}),!p&&!P&&(!n||n.length===0)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-500 dark:text-gray-400 mb-4",children:i||t.category?"No posts found matching your criteria":"No posts available"}),A&&!i&&!t.category&&e.jsx(y,{onClick:()=>u(!0),children:"Create the first post"})]})]})]})]})}),m&&e.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black bg-opacity-50",onClick:()=>j(!1),children:e.jsxs("div",{className:"absolute right-0 top-0 h-full w-80 bg-white dark:bg-gray-800 shadow-xl transform transition-transform",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Filters"}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>j(!1),children:"Close"})]})}),e.jsxs("div",{className:"p-4 overflow-y-auto h-full",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:r=>g(r.target.value),placeholder:"Search by title or author...",className:"w-full pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx(R,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 absolute left-3 top-1/2 transform -translate-y-1/2"}),i&&e.jsx("button",{onClick:()=>g(""),className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",title:"Clear search",children:"✕"})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Sort by"}),e.jsx("select",{value:`${t.sortBy}:${t.sortOrder}`,onChange:r=>F(r.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:E.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Category"}),e.jsxs("select",{value:t.category||"",onChange:r=>x({category:r.target.value||void 0}),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Categories"}),L.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]})]}),e.jsx(M,{filters:t,onFiltersChange:x,onClearSearch:S,className:"block"})]})]})}),e.jsx(J,{isOpen:h,onClose:_,editPost:v})]})};export{Pe as default};
//# sourceMappingURL=Posts-BddUmKKV.js.map
