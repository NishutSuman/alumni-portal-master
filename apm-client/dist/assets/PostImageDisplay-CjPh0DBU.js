import{r as d,R as w}from"./router-DFnE1L-t.js";import{x as R,c as y}from"./index-P8gjH_om.js";import{j as n,A as j,m as k}from"./ui-BlmhFX_F.js";import{F as v}from"./PhotoIcon-n1eOvNeY.js";import{F as b}from"./XMarkIcon-D1c1wIzV.js";import{F as $}from"./ChevronLeftIcon-D6giPwF6.js";import{F as T}from"./ChevronRightIcon-CdFql2QB.js";function q({title:r,titleId:e,...t},s){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":e},t),r?d.createElement("title",{id:e},r):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}))}const O=d.forwardRef(q),f=R.injectEndpoints({endpoints:r=>({getPosts:r.query({query:e=>{const{forceRefresh:t,...s}=e;return{url:"/posts",params:{...s,...t&&{_t:Date.now()}}}},transformResponse:e=>({posts:e.data,pagination:e.pagination}),providesTags:e=>["Post",...e?.posts?.map(({id:t})=>({type:"Post",id:t}))??[]],keepUnusedDataFor:300}),getPostById:r.query({query:e=>`/posts/${e}`,providesTags:(e,t,s)=>[{type:"Post",id:s}]}),getPendingPosts:r.query({query:e=>({url:"/posts/admin/pending",params:e}),transformResponse:e=>({posts:e.data,pagination:e.pagination}),providesTags:["PendingPost"]}),createPost:r.mutation({queryFn:async(e,{getState:t})=>{try{const o=t().auth.token;console.log("ðŸš€ Custom queryFn for createPost:",{isFormData:e instanceof FormData,hasToken:!!o});const a=await fetch(y("/api/posts"),{method:"POST",headers:{...o&&{authorization:`Bearer ${o}`}},body:e});if(!a.ok){const m=await a.json().catch(()=>({message:"Request failed"}));throw new Error(m.message||`HTTP error! status: ${a.status}`)}const l=await a.json();return{data:l.data||l}}catch(s){return console.error("createPost queryFn error:",s),{error:{status:"FETCH_ERROR",error:s.message,data:{message:s.message}}}}},invalidatesTags:["Post","PendingPost"]}),updatePost:r.mutation({queryFn:async({postId:e,formData:t},{getState:s})=>{try{const a=s().auth.token;console.log("ðŸš€ Custom queryFn for updatePost:",{postId:e,isFormData:t instanceof FormData,hasToken:!!a});const l=await fetch(y(`/api/posts/${e}`),{method:"PUT",headers:{...a&&{authorization:`Bearer ${a}`}},body:t});if(!l.ok){const c=await l.json().catch(()=>({message:"Request failed"}));throw new Error(c.message||`HTTP error! status: ${l.status}`)}const m=await l.json();return{data:m.data||m}}catch(o){return console.error("updatePost queryFn error:",o),{error:{status:"FETCH_ERROR",error:o.message,data:{message:o.message}}}}},invalidatesTags:(e,t,{postId:s})=>["Post",{type:"Post",id:s},"PendingPost"]}),archivePost:r.mutation({query:({postId:e,isArchived:t})=>({url:`/posts/${e}/archive`,method:"PATCH",body:t!==void 0?{isArchived:t}:{}}),invalidatesTags:(e,t,{postId:s})=>["Post",{type:"Post",id:s}]}),approvePost:r.mutation({query:({postId:e,approved:t,feedback:s})=>({url:`/posts/${e}/approve`,method:"PATCH",body:{action:t?"approve":"reject",reason:s||(t?"Manual approval":"Manual rejection")}}),invalidatesTags:(e,t,{postId:s})=>["Post",{type:"Post",id:s},"PendingPost"]}),deletePost:r.mutation({query:e=>({url:`/posts/${e}`,method:"DELETE"}),invalidatesTags:(e,t,s)=>["Post",{type:"Post",id:s},"PendingPost"]}),toggleLike:r.mutation({query:e=>({url:`/posts/${e}/like`,method:"POST"}),onQueryStarted:async(e,{dispatch:t,queryFulfilled:s})=>{try{const{data:o}=await s;t(f.util.updateQueryData("getPostById",e,a=>{a&&(a.likeCount=o.likeCount,a.isLikedByUser=o.isLiked)})),t(f.util.updateQueryData("getPosts",{},a=>{const l=a.posts?.find(m=>m.id===e);l&&(l.likeCount=o.likeCount,l.isLikedByUser=o.isLiked)}))}catch{}}}),getPostLikes:r.query({query:({postId:e,...t})=>({url:`/posts/${e}/likes`,params:t}),providesTags:(e,t,{postId:s})=>[{type:"PostLikes",id:s}]}),checkUserLike:r.query({query:e=>`/posts/${e}/like/status`,providesTags:(e,t,s)=>[{type:"UserLike",id:s}]}),toggleReaction:r.mutation({query:({postId:e,reactionType:t})=>({url:`/posts/${e}/reactions`,method:"POST",body:{reactionType:t}}),onQueryStarted:async({postId:e},{dispatch:t,queryFulfilled:s,getState:o})=>{try{const{data:a}=await s;t(f.util.updateQueryData("getPostReactions",e,c=>{c&&(c.reactions=a.reactions,c.userReactions=a.userReactions,c.totalReactions=a.totalReactions,c.likeCount=a.likeCount,c.isLiked=a.isLiked)}));const m=o().api.queries;Object.keys(m).forEach(c=>{if(c.startsWith("getPosts("))try{const h=JSON.parse(c.replace("getPosts(","").replace(")",""));t(f.util.updateQueryData("getPosts",h,P=>{const p=P.posts?.find(x=>x.id===e);p&&(p.reactionCounts=a.reactions,p.totalReactions=a.totalReactions,p.userReactions=a.userReactions,p.likeCount=a.likeCount,p.isLikedByUser=a.isLiked)}))}catch{}}),t(f.util.updateQueryData("getPostById",e,c=>{c&&(c.reactionCounts=a.reactions,c.totalReactions=a.totalReactions,c.userReactions=a.userReactions,c.likeCount=a.likeCount,c.isLikedByUser=a.isLiked)}))}catch(a){console.error("Error updating reaction cache:",a)}},invalidatesTags:(e,t,{postId:s})=>["Post",{type:"PostReactions",id:s},{type:"PostReactionUsers",id:s},{type:"Post",id:s},"PendingPost"]}),getPostReactions:r.query({query:e=>`/posts/${e}/reactions`,providesTags:(e,t,s)=>[{type:"PostReactions",id:s}]}),getPostReactionUsers:r.query({query:({postId:e,reactionType:t,page:s=1,limit:o=20})=>({url:`/posts/${e}/reactions/users`,params:{reactionType:t,page:s,limit:o}}),transformResponse:e=>e.data,providesTags:(e,t,{postId:s})=>[{type:"PostReactionUsers",id:s}]}),getPostComments:r.query({query:({postId:e,...t})=>({url:`/posts/${e}/comments`,params:t}),transformResponse:e=>({comments:e.data,pagination:e.pagination}),providesTags:(e,t,{postId:s})=>[{type:"PostComments",id:s},...e?.comments?.map(({id:o})=>({type:"Comment",id:o}))??[]]}),createComment:r.mutation({query:({postId:e,...t})=>({url:`/posts/${e}/comments`,method:"POST",body:t}),invalidatesTags:(e,t,{postId:s})=>[{type:"PostComments",id:s},{type:"Post",id:s}]}),updateComment:r.mutation({query:({postId:e,commentId:t,...s})=>({url:`/posts/${e}/comments/${t}`,method:"PUT",body:s}),invalidatesTags:(e,t,{postId:s,commentId:o})=>[{type:"PostComments",id:s},{type:"Comment",id:o}]}),deleteComment:r.mutation({query:({postId:e,commentId:t})=>({url:`/posts/${e}/comments/${t}`,method:"DELETE"}),invalidatesTags:(e,t,{postId:s,commentId:o})=>[{type:"PostComments",id:s},{type:"Comment",id:o},{type:"Post",id:s}]}),createReply:r.mutation({query:({postId:e,commentId:t,...s})=>({url:`/posts/${e}/comments/${t}/replies`,method:"POST",body:s}),invalidatesTags:(e,t,{postId:s})=>[{type:"PostComments",id:s}]}),toggleCommentReaction:r.mutation({query:({postId:e,commentId:t,...s})=>({url:`/posts/${e}/comments/${t}/reactions`,method:"POST",body:s}),invalidatesTags:(e,t,{postId:s,commentId:o})=>[{type:"PostComments",id:s},{type:"Comment",id:o},{type:"CommentReactions",id:o}]}),getCommentReactions:r.query({query:({postId:e,commentId:t})=>({url:`/posts/${e}/comments/${t}/reactions`}),transformResponse:e=>e.data,providesTags:(e,t,{commentId:s})=>[{type:"CommentReactions",id:s}]}),getCommentReactionUsers:r.query({query:({postId:e,commentId:t,reactionType:s,page:o=1,limit:a=20})=>({url:`/posts/${e}/comments/${t}/reactions/users`,params:{reactionType:s,page:o,limit:a}}),transformResponse:e=>e.data,providesTags:(e,t,{commentId:s})=>[{type:"CommentReactionUsers",id:s}]})})}),{useGetPostsQuery:S,useGetPendingPostsQuery:Q,useCreatePostMutation:B,useUpdatePostMutation:H,useArchivePostMutation:A,useApprovePostMutation:z,useDeletePostMutation:G,useToggleLikeMutation:_,useToggleReactionMutation:V,useGetPostReactionUsersQuery:W,useGetPostCommentsQuery:K,useCreateCommentMutation:J,useUpdateCommentMutation:Z,useDeleteCommentMutation:X,useCreateReplyMutation:Y,useToggleCommentReactionMutation:I,useGetCommentReactionUsersQuery:ee}=f,te=({postId:r,heroImage:e,images:t,title:s})=>{const[o,a]=d.useState(!1),[l,m]=d.useState(0),c=[...e?[y(`/api/posts/${r}/hero-image`)]:[],...t.map((u,i)=>y(`/api/posts/${r}/images/${i}`))],h=d.useCallback(u=>{m(u),a(!0)},[]),P=d.useCallback(()=>{a(!1)},[]),p=d.useCallback(u=>{m(u==="prev"?i=>i===0?c.length-1:i-1:i=>i===c.length-1?0:i+1)},[c.length]),x=d.useCallback(u=>{if(o)switch(u.key){case"ArrowLeft":p("prev");break;case"ArrowRight":p("next");break;case"Escape":P();break}},[o,p,P]);return w.useEffect(()=>(document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)),[x]),!e&&(!t||t.length===0)?null:n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"mb-4 -mx-4",children:[e&&n.jsxs("div",{className:"relative overflow-hidden bg-gray-100 dark:bg-gray-800 cursor-pointer",children:[n.jsx("img",{src:y(`/api/posts/${r}/hero-image`),alt:s,className:"w-full h-auto object-contain max-h-80",style:{minHeight:"200px"},onClick:()=>h(0),onLoad:u=>{const i=u.target,g=i.naturalWidth/i.naturalHeight;g>2.5?i.className="w-full h-64 object-cover cursor-pointer":g<.6?(i.className="w-full h-auto object-contain max-h-96 mx-auto cursor-pointer",i.parentElement.style.display="flex",i.parentElement.style.justifyContent="center"):i.className="w-full h-auto object-contain max-h-80 cursor-pointer"}}),t.length>0&&n.jsxs("div",{className:"absolute top-3 right-3 bg-black bg-opacity-60 text-white px-2 py-1 rounded-full text-sm flex items-center space-x-1",children:[n.jsx(v,{className:"h-4 w-4"}),n.jsx("span",{children:c.length})]})]}),t.length>0&&n.jsxs("div",{className:"px-4 mt-3",children:[!e&&n.jsxs("div",{className:"relative overflow-hidden bg-gray-100 dark:bg-gray-800 rounded-lg mb-3 cursor-pointer",children:[n.jsx("img",{src:y(`/api/posts/${r}/images/0`),alt:`${s} - Image 1`,className:"w-full h-auto object-contain max-h-80",onClick:()=>h(0),onLoad:u=>{const i=u.target,g=i.naturalWidth/i.naturalHeight;g>2.5?i.className="w-full h-64 object-cover cursor-pointer":g<.6?(i.className="w-full h-auto object-contain max-h-96 mx-auto cursor-pointer",i.parentElement.style.display="flex",i.parentElement.style.justifyContent="center"):i.className="w-full h-auto object-contain max-h-80 cursor-pointer"}}),n.jsxs("div",{className:"absolute top-3 right-3 bg-black bg-opacity-60 text-white px-2 py-1 rounded-full text-sm flex items-center space-x-1",children:[n.jsx(v,{className:"h-4 w-4"}),n.jsx("span",{children:t.length})]})]}),(e?t.length>0:t.length>1)&&n.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:(e?t:t.slice(1)).map((u,i)=>{const g=e?i:i+1,C=i+1;return n.jsxs("div",{className:"relative flex-shrink-0 w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>h(C),children:[n.jsx("img",{src:y(`/api/posts/${r}/images/${g}`),alt:`${s} - Image ${g+1}`,className:"w-full h-full object-cover"}),i===4&&(e?t.length>5:t.length>6)&&n.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center",children:n.jsxs("span",{className:"text-white text-xs font-medium",children:["+",e?t.length-5:t.length-6]})})]},g)})})]})]}),n.jsx(j,{children:o&&n.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",onClick:P,children:n.jsxs("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:[n.jsx("button",{onClick:P,className:"absolute top-4 right-4 z-10 p-2 rounded-full bg-black bg-opacity-50 text-white hover:bg-opacity-70 transition-all",children:n.jsx(b,{className:"h-6 w-6"})}),n.jsxs("div",{className:"absolute top-4 left-4 z-10 bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm",children:[l+1," / ",c.length]}),c.length>1&&n.jsx("button",{onClick:u=>{u.stopPropagation(),p("prev")},className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10 p-3 rounded-full bg-black bg-opacity-50 text-white hover:bg-opacity-70 transition-all",children:n.jsx($,{className:"h-6 w-6"})}),c.length>1&&n.jsx("button",{onClick:u=>{u.stopPropagation(),p("next")},className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 p-3 rounded-full bg-black bg-opacity-50 text-white hover:bg-opacity-70 transition-all",children:n.jsx(T,{className:"h-6 w-6"})}),n.jsx(k.img,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},src:c[l],alt:`${s} - Image ${l+1}`,className:"max-w-full max-h-full object-contain",onClick:u=>u.stopPropagation()},l)]})})})]})};export{O as F,te as P,z as a,G as b,A as c,Q as d,W as e,ee as f,K as g,J as h,Y as i,I as j,Z as k,X as l,_ as m,V as n,B as o,H as p,S as u};
//# sourceMappingURL=PostImageDisplay-CjPh0DBU.js.map
