{"version":3,"file":"PollManagement-j0RUxW3G.js","sources":["../../src/pages/admin/PollManagement.tsx"],"sourcesContent":["// src/pages/admin/PollManagement.tsx\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useForm, useFieldArray } from 'react-hook-form';\nimport {\n  ChartBarIcon,\n  PlusIcon,\n  PencilIcon,\n  TrashIcon,\n  MagnifyingGlassIcon,\n  FunnelIcon,\n  ExclamationTriangleIcon,\n  XMarkIcon,\n  CalendarIcon,\n} from '@heroicons/react/24/outline';\nimport { useAuth } from '@/hooks/useAuth';\nimport {\n  useGetPollsQuery,\n  useDeletePollMutation,\n  useForceDeletePollMutation,\n  useUpdatePollMutation,\n  useCreatePollMutation,\n} from '@/store/api/pollApi';\nimport { Poll, PollFilters } from '@/store/api/pollApi';\nimport { toast } from 'react-hot-toast';\nimport { format } from 'date-fns';\n\n// Form types\ninterface CreatePollFormData {\n  title: string;\n  description: string;\n  options: { text: string }[];\n  allowMultiple: boolean;\n  isAnonymous: boolean;\n  expiresAt: string;\n}\n\ninterface UpdatePollFormData {\n  title: string;\n  description: string;\n  allowMultiple: boolean;\n  isAnonymous: boolean;\n  expiresAt: string;\n  isActive: boolean;\n  addOptions: { text: string }[];\n  removeOptionIds: string[];\n}\n\nconst PollManagement: React.FC = () => {\n  const { user } = useAuth();\n  const [activeTab, setActiveTab] = useState<'manage' | 'create'>('manage');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [filters, setFilters] = useState<PollFilters>({\n    page: 1,\n    limit: 20,\n    sortBy: 'createdAt',\n    sortOrder: 'desc',\n  });\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState<{\n    poll: Poll;\n    forceDelete: boolean;\n  } | null>(null);\n  const [editingPoll, setEditingPoll] = useState<Poll | null>(null);\n  const [newOptions, setNewOptions] = useState<{ text: string }[]>([]);\n  const [optionsToRemove, setOptionsToRemove] = useState<string[]>([]);\n  const [showOptionsWarning, setShowOptionsWarning] = useState(false);\n\n  const [deletePoll] = useDeletePollMutation();\n  const [forceDeletePoll] = useForceDeletePollMutation();\n  const [updatePoll] = useUpdatePollMutation();\n  const [createPoll] = useCreatePollMutation();\n\n  // React Hook Form setup for create poll (always initialize)\n  const {\n    register,\n    control,\n    handleSubmit,\n    watch,\n    reset,\n    formState: { errors, isSubmitting },\n  } = useForm<CreatePollFormData>({\n    defaultValues: {\n      title: '',\n      description: '',\n      options: [{ text: '' }, { text: '' }], // Start with 2 empty options\n      allowMultiple: false,\n      isAnonymous: false,\n      expiresAt: '',\n    },\n  });\n\n  // useFieldArray for dynamic options (always initialize)\n  const { fields, append, remove } = useFieldArray({\n    control,\n    name: 'options',\n  });\n\n  // React Hook Form setup for update poll\n  const {\n    register: registerUpdate,\n    handleSubmit: handleSubmitUpdate,\n    reset: resetUpdate,\n    setValue: setValueUpdate,\n    getValues: getValuesUpdate,\n    formState: { errors: errorsUpdate, isSubmitting: isSubmittingUpdate },\n  } = useForm<UpdatePollFormData>();\n\n  // Handle form submission for create poll\n  const onSubmit = async (data: CreatePollFormData) => {\n    try {\n      // Filter out empty options\n      const validOptions = data.options.filter(option => option.text.trim());\n      \n      if (validOptions.length < 2) {\n        toast.error('Please provide at least 2 options');\n        return;\n      }\n\n      const pollData = {\n        title: data.title,\n        description: data.description,\n        options: validOptions.map(option => option.text), // Convert to string array\n        allowMultiple: data.allowMultiple,\n        isAnonymous: data.isAnonymous,\n        ...(data.expiresAt && { expiresAt: new Date(data.expiresAt).toISOString() }),\n      };\n\n      console.log('Sending poll data:', pollData);\n      await createPoll(pollData).unwrap();\n      toast.success('Poll created successfully! All users have been notified.');\n      reset();\n      setActiveTab('manage');\n      // Force refetch to bypass cache\n      refetchPolls();\n    } catch (error: any) {\n      console.error('Create poll error:', error);\n      toast.error(error?.data?.message || 'Failed to create poll');\n    }\n  };\n\n  // Get polls\n  const {\n    data: pollsData,\n    isLoading: pollsLoading,\n    refetch: refetchPolls,\n  } = useGetPollsQuery(filters);\n\n  // Handle search with debounce\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setFilters(prev => ({\n        ...prev,\n        search: searchQuery.trim(),\n        page: 1,\n      }));\n    }, 500);\n\n    return () => clearTimeout(timer);\n  }, [searchQuery]);\n\n  // Handle edit poll\n  const handleEditPoll = (poll: Poll) => {\n    setEditingPoll(poll);\n    setNewOptions([]);\n    setOptionsToRemove([]);\n    setShowOptionsWarning(false);\n    // Populate the update form with existing poll data\n    setValueUpdate('title', poll.title);\n    setValueUpdate('description', poll.description || '');\n    setValueUpdate('expiresAt', poll.expiresAt ? new Date(poll.expiresAt).toISOString().slice(0, 16) : '');\n  };\n\n  // Handle update poll submission\n  const onUpdateSubmit = async (data: UpdatePollFormData) => {\n    if (!editingPoll) return;\n\n    // Check if we need to show warning for destructive changes\n    const hasVotes = editingPoll.totalVotes > 0;\n    const hasNewOptions = newOptions.some(opt => opt.text.trim());\n    const hasDestructiveChanges = optionsToRemove.length > 0 || hasNewOptions;\n\n    if (hasDestructiveChanges && !showOptionsWarning) {\n      setShowOptionsWarning(true);\n      return;\n    }\n\n    try {\n      const updateData = {\n        title: data.title,\n        description: data.description,\n        ...(data.expiresAt && { expiresAt: new Date(data.expiresAt).toISOString() }),\n        ...(newOptions.length > 0 && { addOptions: newOptions.map(opt => opt.text).filter(text => text.trim()) }),\n        ...(optionsToRemove.length > 0 && { removeOptionIds: optionsToRemove }),\n      };\n\n      console.log('üîç Frontend update data:', {\n        updateData,\n        newOptions,\n        optionsToRemove,\n        pollId: editingPoll.id\n      });\n\n      await updatePoll({\n        pollId: editingPoll.id,\n        data: updateData,\n      }).unwrap();\n\n      toast.success('Poll updated successfully!');\n      setEditingPoll(null);\n      setNewOptions([]);\n      setOptionsToRemove([]);\n      setShowOptionsWarning(false);\n      resetUpdate();\n      refetchPolls();\n    } catch (error: any) {\n      console.error('Update poll error:', error);\n      toast.error(error?.data?.message || 'Failed to update poll');\n    }\n  };\n\n  const handleTogglePollStatus = async (poll: Poll) => {\n    try {\n      const response = await updatePoll({\n        pollId: poll.id,\n        data: { isActive: !poll.isActive },\n      }).unwrap();\n\n      toast.success(`Poll ${poll.isActive ? 'deactivated' : 'activated'} successfully`);\n      refetchPolls();\n    } catch (error: any) {\n      toast.error(error?.data?.message || 'Failed to update poll status');\n    }\n  };\n\n  const handleDeletePoll = async (poll: Poll, forceDelete = false) => {\n    try {\n      if (forceDelete) {\n        await forceDeletePoll(poll.id).unwrap();\n        toast.success('Poll force deleted successfully');\n      } else {\n        await deletePoll(poll.id).unwrap();\n        toast.success('Poll deleted successfully');\n      }\n      \n      setShowDeleteConfirm(null);\n      refetchPolls();\n    } catch (error: any) {\n      if (error?.data?.message?.includes('votes')) {\n        setShowDeleteConfirm({ poll, forceDelete: true });\n      } else {\n        toast.error(error?.data?.message || 'Failed to delete poll');\n      }\n    }\n  };\n\n\n  const renderManageTab = () => (\n    <div className=\"space-y-6\">\n      {/* Search and Filters */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"flex-1 relative\">\n            <MagnifyingGlassIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search polls...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n            />\n          </div>\n          <button className=\"flex items-center space-x-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\n            <FunnelIcon className=\"h-5 w-5\" />\n            <span>Filters</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Polls Table */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden\">\n        <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">All Polls</h3>\n        </div>\n\n        {pollsLoading ? (\n          <div className=\"p-6\">\n            <div className=\"animate-pulse space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <div key={i} className=\"flex items-center space-x-4\">\n                  <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded flex-1\"></div>\n                  <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20\"></div>\n                  <div className=\"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16\"></div>\n                </div>\n              ))}\n            </div>\n          </div>\n        ) : pollsData?.polls && pollsData.polls.length > 0 ? (\n          <div className=\"overflow-x-auto\">\n            <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\n              <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                <tr>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                    Poll\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                    Creator\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                    Votes\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                    Status\n                  </th>\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                    Created\n                  </th>\n                  <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider\">\n                    Actions\n                  </th>\n                </tr>\n              </thead>\n              <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\n                {pollsData.polls.map((poll) => {\n                  const isExpired = poll.expiresAt && new Date() > new Date(poll.expiresAt);\n                  \n                  return (\n                    <tr key={poll.id} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors\">\n                      <td className=\"px-6 py-4\">\n                        <div>\n                          <div className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                            {poll.title}\n                          </div>\n                          {poll.description && (\n                            <div className=\"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs\">\n                              {poll.description}\n                            </div>\n                          )}\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"text-sm text-gray-900 dark:text-white\">\n                          {poll.creator.fullName}\n                        </div>\n                        <div className=\"text-sm text-gray-500 dark:text-gray-400\">\n                          Batch {poll.creator.batch}\n                        </div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white\">\n                        {poll.totalVotes}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${\n                          isExpired\n                            ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-300'\n                            : poll.isActive\n                            ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300'\n                            : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300'\n                        }`}>\n                          {isExpired ? 'Expired' : poll.isActive ? 'Active' : 'Inactive'}\n                        </span>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\n                        {format(new Date(poll.createdAt), 'MMM d, yyyy')}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\n                        <div className=\"flex items-center justify-end space-x-2\">\n                          {(user?.role === 'SUPER_ADMIN' || poll.createdBy === user?.id) && (\n                            <>\n                              {!isExpired && (\n                                <button\n                                  onClick={() => handleEditPoll(poll)}\n                                  className=\"text-yellow-600 dark:text-yellow-400 hover:text-yellow-900 dark:hover:text-yellow-300\"\n                                  title=\"Edit Poll\"\n                                >\n                                  <PencilIcon className=\"h-4 w-4\" />\n                                </button>\n                              )}\n                              \n                              {!isExpired && (\n                                <button\n                                  onClick={() => handleTogglePollStatus(poll)}\n                                  className={`px-3 py-1 rounded text-xs font-medium transition-colors ${\n                                    poll.isActive\n                                      ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800'\n                                      : 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-800'\n                                  }`}\n                                  title={poll.isActive ? 'Deactivate Poll' : 'Activate Poll'}\n                                >\n                                  {poll.isActive ? 'Deactivate' : 'Activate'}\n                                </button>\n                              )}\n                              \n                              <button\n                                onClick={() => setShowDeleteConfirm({ poll, forceDelete: false })}\n                                className=\"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300\"\n                                title=\"Delete Poll\"\n                              >\n                                <TrashIcon className=\"h-4 w-4\" />\n                              </button>\n                            </>\n                          )}\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        ) : (\n          <div className=\"p-12 text-center\">\n            <ChartBarIcon className=\"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">No polls found</h3>\n            <p className=\"text-gray-600 dark:text-gray-400\">\n              {searchQuery ? 'Try adjusting your search terms.' : 'Create your first poll to get started.'}\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  const renderCreateTab = () => {\n    return (\n      <div className=\"max-w-2xl mx-auto\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700\">\n          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-6\">Create New Poll</h3>\n          \n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n            {/* Poll Title */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Poll Title *\n              </label>\n              <input\n                type=\"text\"\n                {...register('title', { \n                  required: 'Poll title is required',\n                  minLength: { value: 3, message: 'Title must be at least 3 characters' },\n                  maxLength: { value: 200, message: 'Title must not exceed 200 characters' }\n                })}\n                placeholder=\"Enter poll title...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n              />\n              {errors.title && (\n                <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">{errors.title.message}</p>\n              )}\n            </div>\n\n            {/* Poll Description */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Description\n              </label>\n              <textarea\n                {...register('description', {\n                  maxLength: { value: 1000, message: 'Description must not exceed 1000 characters' }\n                })}\n                rows={3}\n                placeholder=\"Enter poll description (optional)...\"\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n              />\n              {errors.description && (\n                <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">{errors.description.message}</p>\n              )}\n            </div>\n\n            {/* Poll Options */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Poll Options *\n              </label>\n              <div className=\"space-y-3\">\n                {fields.map((field, index) => (\n                  <div key={field.id} className=\"flex items-center space-x-3\">\n                    <div className=\"flex-1\">\n                      <input\n                        type=\"text\"\n                        {...register(`options.${index}.text`, {\n                          required: index < 2 ? 'Option is required' : false,\n                          maxLength: { value: 200, message: 'Option must not exceed 200 characters' }\n                        })}\n                        placeholder={`Option ${index + 1}${index < 2 ? ' (required)' : ''}`}\n                        className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                      />\n                      {errors.options?.[index]?.text && (\n                        <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\n                          {errors.options[index]?.text?.message}\n                        </p>\n                      )}\n                    </div>\n                    {fields.length > 2 && (\n                      <button\n                        type=\"button\"\n                        onClick={() => remove(index)}\n                        className=\"p-2 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 transition-colors\"\n                      >\n                        <XMarkIcon className=\"h-5 w-5\" />\n                      </button>\n                    )}\n                  </div>\n                ))}\n              </div>\n              \n              {fields.length < 10 && (\n                <button\n                  type=\"button\"\n                  onClick={() => append({ text: '' })}\n                  className=\"mt-3 flex items-center space-x-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors\"\n                >\n                  <PlusIcon className=\"h-4 w-4\" />\n                  <span>Add Option</span>\n                </button>\n              )}\n            </div>\n\n            {/* Poll Settings */}\n            <div className=\"space-y-4\">\n              <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Poll Settings</h4>\n              \n              <div className=\"flex items-center space-x-3\">\n                <input\n                  type=\"checkbox\"\n                  id=\"allowMultiple\"\n                  {...register('allowMultiple')}\n                  className=\"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500\"\n                />\n                <label htmlFor=\"allowMultiple\" className=\"text-sm text-gray-700 dark:text-gray-300\">\n                  Allow multiple selections\n                </label>\n              </div>\n\n              <div className=\"flex items-center space-x-3\">\n                <input\n                  type=\"checkbox\"\n                  id=\"isAnonymous\"\n                  {...register('isAnonymous')}\n                  className=\"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500\"\n                />\n                <label htmlFor=\"isAnonymous\" className=\"text-sm text-gray-700 dark:text-gray-300\">\n                  Anonymous voting\n                </label>\n              </div>\n            </div>\n\n            {/* Expiration Date */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                Expiration Date (Optional)\n              </label>\n              <div className=\"relative\">\n                <input\n                  type=\"datetime-local\"\n                  {...register('expiresAt', {\n                    validate: (value) => {\n                      if (value && new Date(value) <= new Date()) {\n                        return 'Expiration date must be in the future';\n                      }\n                      return true;\n                    }\n                  })}\n                  min={new Date().toISOString().slice(0, 16)}\n                  className=\"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                />\n                <CalendarIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n              </div>\n              {errors.expiresAt && (\n                <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">{errors.expiresAt.message}</p>\n              )}\n              <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n                Leave empty for no expiration\n              </p>\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700\">\n              <button\n                type=\"button\"\n                onClick={() => reset()}\n                className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n              >\n                Reset Form\n              </button>\n              \n              <button\n                type=\"submit\"\n                disabled={isSubmitting}\n                className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2\"\n              >\n                {isSubmitting ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                    <span>Creating...</span>\n                  </>\n                ) : (\n                  <>\n                    <PlusIcon className=\"h-4 w-4\" />\n                    <span>Create Poll</span>\n                  </>\n                )}\n              </button>\n            </div>\n          </form>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Poll Management</h1>\n              <p className=\"text-gray-600 dark:text-gray-400\">\n                Create and manage community polls\n              </p>\n            </div>\n          </div>\n\n          {/* Tab Navigation */}\n          <div className=\"mt-6 flex space-x-8\">\n            {[\n              { id: 'manage', label: 'Manage Polls' },\n              ...(user?.role === 'SUPER_ADMIN' || user?.role === 'BATCH_ADMIN' \n                ? [{ id: 'create', label: 'Create Poll' }] \n                : []\n              ),\n            ].map((tab) => (\n              <button\n                key={tab.id}\n                onClick={() => setActiveTab(tab.id as any)}\n                className={`pb-2 px-1 border-b-2 font-medium text-sm transition-colors ${\n                  activeTab === tab.id\n                    ? 'border-blue-500 text-blue-600 dark:text-blue-400'\n                    : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'\n                }`}\n              >\n                {tab.label}\n              </button>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Content */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <motion.div\n          key={activeTab}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.2 }}\n        >\n          {activeTab === 'manage' && renderManageTab()}\n          {activeTab === 'create' && (user?.role === 'SUPER_ADMIN' || user?.role === 'BATCH_ADMIN') && renderCreateTab()}\n        </motion.div>\n      </div>\n\n      {/* Update Poll Modal */}\n      <AnimatePresence>\n        {editingPoll && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\"\n            onClick={() => setEditingPoll(null)}\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.95, opacity: 0 }}\n              onClick={(e) => e.stopPropagation()}\n              className=\"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto\"\n            >\n              <div className=\"flex items-center justify-between mb-6\">\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Update Poll</h3>\n                <button\n                  onClick={() => setEditingPoll(null)}\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                >\n                  <XMarkIcon className=\"h-6 w-6\" />\n                </button>\n              </div>\n\n              <form onSubmit={handleSubmitUpdate(onUpdateSubmit)} className=\"space-y-6\">\n                {/* Poll Title */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Poll Title *\n                  </label>\n                  <input\n                    type=\"text\"\n                    {...registerUpdate('title', { \n                      required: 'Poll title is required',\n                      minLength: { value: 3, message: 'Title must be at least 3 characters' },\n                      maxLength: { value: 200, message: 'Title must not exceed 200 characters' }\n                    })}\n                    placeholder=\"Enter poll title...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                  />\n                  {errorsUpdate.title && (\n                    <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">{errorsUpdate.title.message}</p>\n                  )}\n                </div>\n\n                {/* Poll Description */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Description\n                  </label>\n                  <textarea\n                    {...registerUpdate('description', {\n                      maxLength: { value: 1000, message: 'Description must not exceed 1000 characters' }\n                    })}\n                    rows={3}\n                    placeholder=\"Enter poll description (optional)...\"\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                  />\n                  {errorsUpdate.description && (\n                    <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">{errorsUpdate.description.message}</p>\n                  )}\n                </div>\n\n                {/* Current Poll Options */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Poll Options (Admin can modify)\n                  </label>\n                  \n                  {/* Existing Options */}\n                  <div className=\"space-y-2 mb-4\">\n                    {editingPoll.options?.map((option, index) => (\n                      <div key={option.id} className={`p-3 rounded-lg border ${\n                        optionsToRemove.includes(option.id) \n                          ? 'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800' \n                          : 'bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600'\n                      }`}>\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex-1\">\n                            <span className={`text-sm ${\n                              optionsToRemove.includes(option.id) \n                                ? 'text-red-900 dark:text-red-300 line-through' \n                                : 'text-gray-900 dark:text-white'\n                            }`}>\n                              {index + 1}. {option.text}\n                            </span>\n                            <span className=\"ml-2 text-xs text-gray-500 dark:text-gray-400\">\n                              ({option.voteCount || 0} votes)\n                            </span>\n                          </div>\n                          {user?.role === 'SUPER_ADMIN' && (\n                            <button\n                              type=\"button\"\n                              onClick={() => {\n                                if (optionsToRemove.includes(option.id)) {\n                                  setOptionsToRemove(prev => prev.filter(id => id !== option.id));\n                                } else {\n                                  setOptionsToRemove(prev => [...prev, option.id]);\n                                }\n                              }}\n                              className={`p-1 rounded ${\n                                optionsToRemove.includes(option.id)\n                                  ? 'text-green-600 hover:text-green-800 dark:text-green-400'\n                                  : 'text-red-600 hover:text-red-800 dark:text-red-400'\n                              }`}\n                              title={optionsToRemove.includes(option.id) ? 'Restore option' : 'Remove option'}\n                            >\n                              {optionsToRemove.includes(option.id) ? (\n                                <PlusIcon className=\"h-4 w-4\" />\n                              ) : (\n                                <XMarkIcon className=\"h-4 w-4\" />\n                              )}\n                            </button>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n\n                  {/* New Options */}\n                  {user?.role === 'SUPER_ADMIN' && (\n                    <div>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Add New Options</span>\n                        <button\n                          type=\"button\"\n                          onClick={() => setNewOptions(prev => [...prev, { text: '' }])}\n                          className=\"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm flex items-center space-x-1\"\n                        >\n                          <PlusIcon className=\"h-4 w-4\" />\n                          <span>Add Option</span>\n                        </button>\n                      </div>\n                      \n                      {newOptions.length > 0 && (\n                        <div className=\"space-y-2\">\n                          {newOptions.map((option, index) => (\n                            <div key={index} className=\"flex items-center space-x-2\">\n                              <input\n                                type=\"text\"\n                                value={option.text}\n                                onChange={(e) => {\n                                  const updated = [...newOptions];\n                                  updated[index] = { text: e.target.value };\n                                  setNewOptions(updated);\n                                }}\n                                placeholder={`New option ${index + 1}`}\n                                className=\"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                              />\n                              <button\n                                type=\"button\"\n                                onClick={() => {\n                                  setNewOptions(prev => prev.filter((_, i) => i !== index));\n                                }}\n                                className=\"p-2 text-red-600 hover:text-red-800 dark:text-red-400\"\n                              >\n                                <TrashIcon className=\"h-4 w-4\" />\n                              </button>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  )}\n\n                  {(optionsToRemove.length > 0 || newOptions.some(opt => opt.text.trim())) && (\n                    <div className=\"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg\">\n                      <p className=\"text-sm text-yellow-800 dark:text-yellow-300\">\n                        ‚ö†Ô∏è Modifying options will affect existing voting data and notify all voters.\n                      </p>\n                    </div>\n                  )}\n                </div>\n\n                {/* Poll Settings - Read Only Information */}\n                <div className=\"space-y-4\">\n                  <h4 className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Poll Information</h4>\n                  \n                  <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg space-y-3\">\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Poll Type:</span>\n                      <span className=\"text-sm text-gray-900 dark:text-white\">\n                        {editingPoll?.allowMultiple ? 'Multiple Choice' : 'Single Choice'}\n                      </span>\n                    </div>\n                    \n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Voting Type:</span>\n                      <span className=\"text-sm text-gray-900 dark:text-white\">\n                        {editingPoll?.isAnonymous ? 'Anonymous' : 'Public'}\n                      </span>\n                    </div>\n                    \n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-sm font-medium text-gray-600 dark:text-gray-400\">Current Status:</span>\n                      <span className={`text-sm font-medium ${\n                        editingPoll?.isActive ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'\n                      }`}>\n                        {editingPoll?.isActive ? 'Active' : 'Inactive'}\n                      </span>\n                    </div>\n                    \n                    <div className=\"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded\">\n                      <p className=\"text-xs text-blue-800 dark:text-blue-300\">\n                        üí° Poll settings cannot be changed after creation to maintain data integrity. \n                        Use the Deactivate button in the poll list to disable this poll.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Expiration Date */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Expiration Date (Optional)\n                  </label>\n                  <div className=\"relative\">\n                    <input\n                      type=\"datetime-local\"\n                      {...registerUpdate('expiresAt', {\n                        validate: (value) => {\n                          if (value && new Date(value) <= new Date()) {\n                            return 'Expiration date must be in the future';\n                          }\n                          return true;\n                        }\n                      })}\n                      min={new Date().toISOString().slice(0, 16)}\n                      className=\"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                    />\n                    <CalendarIcon className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400\" />\n                  </div>\n                  {errorsUpdate.expiresAt && (\n                    <p className=\"mt-1 text-sm text-red-600 dark:text-red-400\">{errorsUpdate.expiresAt.message}</p>\n                  )}\n                  <p className=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">\n                    Leave empty for no expiration\n                  </p>\n                </div>\n\n                {/* Action Buttons */}\n                <div className=\"flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700\">\n                  <button\n                    type=\"button\"\n                    onClick={() => setEditingPoll(null)}\n                    className=\"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                  >\n                    Cancel\n                  </button>\n                  \n                  <button\n                    type=\"submit\"\n                    disabled={isSubmittingUpdate}\n                    className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2\"\n                  >\n                    {isSubmittingUpdate ? (\n                      <>\n                        <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                        <span>Updating...</span>\n                      </>\n                    ) : (\n                      <>\n                        <PencilIcon className=\"h-4 w-4\" />\n                        <span>Update Poll</span>\n                      </>\n                    )}\n                  </button>\n                </div>\n              </form>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Delete Confirmation Modal */}\n      <AnimatePresence>\n        {showDeleteConfirm && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\"\n            onClick={() => setShowDeleteConfirm(null)}\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.95, opacity: 0 }}\n              onClick={(e) => e.stopPropagation()}\n              className=\"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full\"\n            >\n              <div className=\"flex items-center mb-4\">\n                <ExclamationTriangleIcon className=\"h-6 w-6 text-red-600 dark:text-red-400 mr-3\" />\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                  {showDeleteConfirm.forceDelete ? 'Force Delete Poll' : 'Delete Poll'}\n                </h3>\n              </div>\n              \n              <p className=\"text-gray-600 dark:text-gray-400 mb-6\">\n                {showDeleteConfirm.forceDelete\n                  ? `This poll has votes and cannot be deleted normally. Are you sure you want to force delete \"${showDeleteConfirm.poll.title}\"? This action cannot be undone.`\n                  : `Are you sure you want to delete \"${showDeleteConfirm.poll.title}\"? This action cannot be undone.`\n                }\n              </p>\n              \n              <div className=\"flex space-x-3\">\n                <button\n                  onClick={() => setShowDeleteConfirm(null)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={() => handleDeletePoll(showDeleteConfirm.poll, showDeleteConfirm.forceDelete)}\n                  className=\"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors\"\n                >\n                  {showDeleteConfirm.forceDelete ? 'Force Delete' : 'Delete'}\n                </button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Options Warning Modal */}\n      <AnimatePresence>\n        {showOptionsWarning && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\"\n            onClick={() => setShowOptionsWarning(false)}\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.95, opacity: 0 }}\n              onClick={(e) => e.stopPropagation()}\n              className=\"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-lg w-full\"\n            >\n              <div className=\"flex items-center mb-4\">\n                <ExclamationTriangleIcon className=\"h-6 w-6 text-yellow-600 dark:text-yellow-400 mr-3\" />\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                  Confirm Poll Modifications\n                </h3>\n              </div>\n              \n              <div className=\"space-y-4 mb-6\">\n                <p className=\"text-gray-600 dark:text-gray-400\">\n                  You are about to make changes that will affect this poll's voting data:\n                </p>\n                \n                {optionsToRemove.length > 0 && (\n                  <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3\">\n                    <p className=\"text-sm font-medium text-red-800 dark:text-red-300 mb-2\">\n                      Removing {optionsToRemove.length} option(s):\n                    </p>\n                    <ul className=\"list-disc list-inside text-sm text-red-700 dark:text-red-300\">\n                      {optionsToRemove.map(optionId => {\n                        const option = editingPoll?.options.find(opt => opt.id === optionId);\n                        return (\n                          <li key={optionId}>\n                            \"{option?.text}\" ({option?.voteCount || 0} votes)\n                          </li>\n                        );\n                      })}\n                    </ul>\n                  </div>\n                )}\n                \n                {newOptions.some(opt => opt.text.trim()) && (\n                  <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\n                    <p className=\"text-sm font-medium text-blue-800 dark:text-blue-300 mb-2\">\n                      Adding {newOptions.filter(opt => opt.text.trim()).length} new option(s):\n                    </p>\n                    <ul className=\"list-disc list-inside text-sm text-blue-700 dark:text-blue-300\">\n                      {newOptions.filter(opt => opt.text.trim()).map((option, index) => (\n                        <li key={index}>\"{option.text}\"</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n                \n                <div className=\"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3\">\n                  <p className=\"text-sm text-yellow-800 dark:text-yellow-300\">\n                    <strong>‚ö†Ô∏è Important:</strong>\n                  </p>\n                  <ul className=\"list-disc list-inside text-sm text-yellow-700 dark:text-yellow-300 mt-1 space-y-1\">\n                    <li>Removed options and their votes will be permanently deleted</li>\n                    <li>All voters will receive a push notification about the poll update</li>\n                    <li>Users can vote again on new options if allowed</li>\n                    <li>This action cannot be undone</li>\n                  </ul>\n                </div>\n              </div>\n              \n              <div className=\"flex space-x-3\">\n                <button\n                  onClick={() => setShowOptionsWarning(false)}\n                  className=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\n                >\n                  Cancel\n                </button>\n                <button\n                  onClick={() => {\n                    setShowOptionsWarning(false);\n                    handleSubmitUpdate(onUpdateSubmit)();\n                  }}\n                  className=\"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium\"\n                >\n                  Proceed with Changes\n                </button>\n              </div>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n};\n\nexport default PollManagement;"],"names":["PollManagement","user","useAuth","activeTab","setActiveTab","useState","searchQuery","setSearchQuery","filters","setFilters","showDeleteConfirm","setShowDeleteConfirm","editingPoll","setEditingPoll","newOptions","setNewOptions","optionsToRemove","setOptionsToRemove","showOptionsWarning","setShowOptionsWarning","deletePoll","useDeletePollMutation","forceDeletePoll","useForceDeletePollMutation","updatePoll","useUpdatePollMutation","createPoll","useCreatePollMutation","register","control","handleSubmit","watch","reset","errors","isSubmitting","useForm","fields","append","remove","useFieldArray","registerUpdate","handleSubmitUpdate","resetUpdate","setValueUpdate","getValuesUpdate","errorsUpdate","isSubmittingUpdate","onSubmit","data","validOptions","option","toast","pollData","refetchPolls","error","pollsData","pollsLoading","useGetPollsQuery","useEffect","timer","prev","handleEditPoll","poll","onUpdateSubmit","hasNewOptions","opt","updateData","text","handleTogglePollStatus","response","handleDeletePoll","forceDelete","renderManageTab","jsxs","jsx","MagnifyingGlassIcon","e","FunnelIcon","_","i","isExpired","format","Fragment","PencilIcon","TrashIcon","ChartBarIcon","renderCreateTab","field","index","XMarkIcon","PlusIcon","value","CalendarIcon","tab","motion","AnimatePresence","id","updated","ExclamationTriangleIcon","optionId"],"mappings":"wvBAgDA,MAAMA,GAA2B,IAAM,CACrC,KAAM,CAAE,KAAAC,CAAA,EAASC,GAAA,EACX,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAA8B,QAAQ,EAClE,CAACC,EAAaC,CAAc,EAAIF,EAAAA,SAAS,EAAE,EAC3C,CAACG,EAASC,CAAU,EAAIJ,WAAsB,CAClD,KAAM,EACN,MAAO,GACP,OAAQ,YACR,UAAW,MAAA,CACZ,EACK,CAACK,EAAmBC,CAAoB,EAAIN,EAAAA,SAGxC,IAAI,EACR,CAACO,EAAaC,CAAc,EAAIR,EAAAA,SAAsB,IAAI,EAC1D,CAACS,EAAYC,CAAa,EAAIV,EAAAA,SAA6B,CAAA,CAAE,EAC7D,CAACW,EAAiBC,CAAkB,EAAIZ,EAAAA,SAAmB,CAAA,CAAE,EAC7D,CAACa,EAAoBC,CAAqB,EAAId,EAAAA,SAAS,EAAK,EAE5D,CAACe,CAAU,EAAIC,GAAA,EACf,CAACC,CAAe,EAAIC,GAAA,EACpB,CAACC,CAAU,EAAIC,GAAA,EACf,CAACC,CAAU,EAAIC,GAAA,EAGf,CACJ,SAAAC,EACA,QAAAC,EACA,aAAAC,EACA,MAAAC,GACA,MAAAC,EACA,UAAW,CAAE,OAAAC,EAAQ,aAAAC,CAAA,CAAa,EAChCC,EAA4B,CAC9B,cAAe,CACb,MAAO,GACP,YAAa,GACb,QAAS,CAAC,CAAE,KAAM,IAAM,CAAE,KAAM,GAAI,EACpC,cAAe,GACf,YAAa,GACb,UAAW,EAAA,CACb,CACD,EAGK,CAAE,OAAAC,EAAQ,OAAAC,EAAQ,OAAAC,EAAA,EAAWC,GAAc,CAC/C,QAAAV,EACA,KAAM,SAAA,CACP,EAGK,CACJ,SAAUW,EACV,aAAcC,EACd,MAAOC,GACP,SAAUC,EACV,UAAWC,GACX,UAAW,CAAE,OAAQC,EAAc,aAAcC,CAAA,CAAmB,EAClEX,EAAA,EAGEY,GAAW,MAAOC,GAA6B,CACnD,GAAI,CAEF,MAAMC,EAAeD,EAAK,QAAQ,UAAiBE,EAAO,KAAK,MAAM,EAErE,GAAID,EAAa,OAAS,EAAG,CAC3BE,EAAM,MAAM,mCAAmC,EAC/C,MACF,CAEA,MAAMC,EAAW,CACf,MAAOJ,EAAK,MACZ,YAAaA,EAAK,YAClB,QAASC,EAAa,IAAIC,GAAUA,EAAO,IAAI,EAC/C,cAAeF,EAAK,cACpB,YAAaA,EAAK,YAClB,GAAIA,EAAK,WAAa,CAAE,UAAW,IAAI,KAAKA,EAAK,SAAS,EAAE,YAAA,CAAY,CAAE,EAG5E,QAAQ,IAAI,qBAAsBI,CAAQ,EAC1C,MAAM1B,EAAW0B,CAAQ,EAAE,OAAA,EAC3BD,EAAM,QAAQ,0DAA0D,EACxEnB,EAAA,EACA5B,EAAa,QAAQ,EAErBiD,EAAA,CACF,OAASC,EAAY,CACnB,QAAQ,MAAM,qBAAsBA,CAAK,EACzCH,EAAM,MAAMG,GAAO,MAAM,SAAW,uBAAuB,CAC7D,CACF,EAGM,CACJ,KAAMC,EACN,UAAWC,GACX,QAASH,CAAA,EACPI,GAAiBjD,CAAO,EAG5BkD,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAQ,WAAW,IAAM,CAC7BlD,EAAWmD,IAAS,CAClB,GAAGA,EACH,OAAQtD,EAAY,KAAA,EACpB,KAAM,CAAA,EACN,CACJ,EAAG,GAAG,EAEN,MAAO,IAAM,aAAaqD,CAAK,CACjC,EAAG,CAACrD,CAAW,CAAC,EAGhB,MAAMuD,GAAkBC,GAAe,CACrCjD,EAAeiD,CAAI,EACnB/C,EAAc,CAAA,CAAE,EAChBE,EAAmB,CAAA,CAAE,EACrBE,EAAsB,EAAK,EAE3BwB,EAAe,QAASmB,EAAK,KAAK,EAClCnB,EAAe,cAAemB,EAAK,aAAe,EAAE,EACpDnB,EAAe,YAAamB,EAAK,UAAY,IAAI,KAAKA,EAAK,SAAS,EAAE,YAAA,EAAc,MAAM,EAAG,EAAE,EAAI,EAAE,CACvG,EAGMC,EAAiB,MAAOf,GAA6B,CACzD,GAAI,CAACpC,EAAa,OAGDA,EAAY,WAAa,EAC1C,MAAMoD,EAAgBlD,EAAW,QAAYmD,EAAI,KAAK,MAAM,EAG5D,IAF8BjD,EAAgB,OAAS,GAAKgD,IAE/B,CAAC9C,EAAoB,CAChDC,EAAsB,EAAI,EAC1B,MACF,CAEA,GAAI,CACF,MAAM+C,EAAa,CACjB,MAAOlB,EAAK,MACZ,YAAaA,EAAK,YAClB,GAAIA,EAAK,WAAa,CAAE,UAAW,IAAI,KAAKA,EAAK,SAAS,EAAE,aAAY,EACxE,GAAIlC,EAAW,OAAS,GAAK,CAAE,WAAYA,EAAW,IAAImD,GAAOA,EAAI,IAAI,EAAE,UAAeE,EAAK,KAAA,CAAM,CAAA,EACrG,GAAInD,EAAgB,OAAS,GAAK,CAAE,gBAAiBA,CAAA,CAAgB,EAGvE,QAAQ,IAAI,2BAA4B,CACtC,WAAAkD,EACA,WAAApD,EACA,gBAAAE,EACA,OAAQJ,EAAY,EAAA,CACrB,EAED,MAAMY,EAAW,CACf,OAAQZ,EAAY,GACpB,KAAMsD,CAAA,CACP,EAAE,OAAA,EAEHf,EAAM,QAAQ,4BAA4B,EAC1CtC,EAAe,IAAI,EACnBE,EAAc,CAAA,CAAE,EAChBE,EAAmB,CAAA,CAAE,EACrBE,EAAsB,EAAK,EAC3BuB,GAAA,EACAW,EAAA,CACF,OAASC,EAAY,CACnB,QAAQ,MAAM,qBAAsBA,CAAK,EACzCH,EAAM,MAAMG,GAAO,MAAM,SAAW,uBAAuB,CAC7D,CACF,EAEMc,GAAyB,MAAON,GAAe,CACnD,GAAI,CACF,MAAMO,EAAW,MAAM7C,EAAW,CAChC,OAAQsC,EAAK,GACb,KAAM,CAAE,SAAU,CAACA,EAAK,QAAA,CAAS,CAClC,EAAE,OAAA,EAEHX,EAAM,QAAQ,QAAQW,EAAK,SAAW,cAAgB,WAAW,eAAe,EAChFT,EAAA,CACF,OAASC,EAAY,CACnBH,EAAM,MAAMG,GAAO,MAAM,SAAW,8BAA8B,CACpE,CACF,EAEMgB,GAAmB,MAAOR,EAAYS,EAAc,KAAU,CAClE,GAAI,CACEA,GACF,MAAMjD,EAAgBwC,EAAK,EAAE,EAAE,OAAA,EAC/BX,EAAM,QAAQ,iCAAiC,IAE/C,MAAM/B,EAAW0C,EAAK,EAAE,EAAE,OAAA,EAC1BX,EAAM,QAAQ,2BAA2B,GAG3CxC,EAAqB,IAAI,EACzB0C,EAAA,CACF,OAASC,EAAY,CACfA,GAAO,MAAM,SAAS,SAAS,OAAO,EACxC3C,EAAqB,CAAE,KAAAmD,EAAM,YAAa,EAAA,CAAM,EAEhDX,EAAM,MAAMG,GAAO,MAAM,SAAW,uBAAuB,CAE/D,CACF,EAGMkB,GAAkB,IACtBC,OAAC,MAAA,CAAI,UAAU,YAEb,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,iGACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,kBACb,SAAA,CAAAC,EAAAA,IAACC,GAAA,CAAoB,UAAU,0EAAA,CAA2E,EAC1GD,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,YAAY,kBACZ,MAAOpE,EACP,SAAWsE,GAAMrE,EAAeqE,EAAE,OAAO,KAAK,EAC9C,UAAU,iMAAA,CAAA,CACZ,EACF,EACAH,EAAAA,KAAC,SAAA,CAAO,UAAU,yJAChB,SAAA,CAAAC,EAAAA,IAACG,GAAA,CAAW,UAAU,SAAA,CAAU,EAChCH,EAAAA,IAAC,QAAK,SAAA,SAAA,CAAO,CAAA,CAAA,CACf,CAAA,CAAA,CACF,CAAA,CACF,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,6GACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,oDACb,SAAAA,EAAAA,IAAC,MAAG,UAAU,sDAAsD,qBAAS,CAAA,CAC/E,EAEClB,SACE,MAAA,CAAI,UAAU,MACb,SAAAkB,EAAAA,IAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAC,GAAG,MAAM,CAAC,CAAC,EAAE,IAAI,CAACI,EAAGC,IACrBN,EAAAA,KAAC,MAAA,CAAY,UAAU,8BACrB,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,iDAAA,CAAkD,EACjEA,EAAAA,IAAC,MAAA,CAAI,UAAU,+CAAA,CAAgD,EAC/DA,EAAAA,IAAC,MAAA,CAAI,UAAU,+CAAA,CAAgD,CAAA,GAHvDK,CAIV,CACD,CAAA,CACH,EACF,EACExB,GAAW,OAASA,EAAU,MAAM,OAAS,QAC9C,MAAA,CAAI,UAAU,kBACb,SAAAkB,OAAC,QAAA,CAAM,UAAU,2DACf,SAAA,CAAAC,MAAC,QAAA,CAAM,UAAU,8BACf,SAAAD,EAAAA,KAAC,KAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,oGAAoG,SAAA,OAElH,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,oGAAoG,SAAA,UAElH,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,oGAAoG,SAAA,QAElH,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,oGAAoG,SAAA,SAElH,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,oGAAoG,SAAA,UAElH,EACAA,EAAAA,IAAC,KAAA,CAAG,UAAU,qGAAqG,SAAA,SAAA,CAEnH,CAAA,CAAA,CACF,CAAA,CACF,EACAA,MAAC,SAAM,UAAU,0EACd,WAAU,MAAM,IAAKZ,GAAS,CAC7B,MAAMkB,EAAYlB,EAAK,WAAa,IAAI,KAAS,IAAI,KAAKA,EAAK,SAAS,EAExE,OACEW,EAAAA,KAAC,KAAA,CAAiB,UAAU,+DAC1B,SAAA,CAAAC,MAAC,KAAA,CAAG,UAAU,YACZ,SAAAD,EAAAA,KAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,oDACZ,SAAAZ,EAAK,MACR,EACCA,EAAK,aACJY,EAAAA,IAAC,OAAI,UAAU,6DACZ,WAAK,WAAA,CACR,CAAA,CAAA,CAEJ,CAAA,CACF,EACAD,EAAAA,KAAC,KAAA,CAAG,UAAU,8BACZ,SAAA,CAAAC,MAAC,MAAA,CAAI,UAAU,wCACZ,SAAAZ,EAAK,QAAQ,SAChB,EACAW,EAAAA,KAAC,MAAA,CAAI,UAAU,2CAA2C,SAAA,CAAA,SACjDX,EAAK,QAAQ,KAAA,CAAA,CACtB,CAAA,EACF,EACAY,EAAAA,IAAC,KAAA,CAAG,UAAU,oEACX,WAAK,WACR,EACAA,EAAAA,IAAC,MAAG,UAAU,8BACZ,eAAC,OAAA,CAAK,UAAW,0DACfM,EACI,4DACAlB,EAAK,SACL,oEACA,+DACN,GACG,SAAAkB,EAAY,UAAYlB,EAAK,SAAW,SAAW,UAAA,CACtD,CAAA,CACF,EACAY,EAAAA,IAAC,KAAA,CAAG,UAAU,uEACX,SAAAO,GAAO,IAAI,KAAKnB,EAAK,SAAS,EAAG,aAAa,CAAA,CACjD,EACAY,MAAC,KAAA,CAAG,UAAU,6DACZ,eAAC,MAAA,CAAI,UAAU,0CACX,UAAAzE,GAAM,OAAS,eAAiB6D,EAAK,YAAc7D,GAAM,KACzDwE,EAAAA,KAAAS,WAAA,CACG,SAAA,CAAA,CAACF,GACAN,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMb,GAAeC,CAAI,EAClC,UAAU,wFACV,MAAM,YAEN,SAAAY,EAAAA,IAACS,EAAA,CAAW,UAAU,SAAA,CAAU,CAAA,CAAA,EAInC,CAACH,GACAN,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMN,GAAuBN,CAAI,EAC1C,UAAW,2DACTA,EAAK,SACD,mGACA,8GACN,GACA,MAAOA,EAAK,SAAW,kBAAoB,gBAE1C,SAAAA,EAAK,SAAW,aAAe,UAAA,CAAA,EAIpCY,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM/D,EAAqB,CAAE,KAAAmD,EAAM,YAAa,GAAO,EAChE,UAAU,4EACV,MAAM,cAEN,SAAAY,EAAAA,IAACU,EAAA,CAAU,UAAU,SAAA,CAAU,CAAA,CAAA,CACjC,CAAA,CACF,EAEJ,CAAA,CACF,CAAA,CAAA,EA5EOtB,EAAK,EA6Ed,CAEJ,CAAC,CAAA,CACH,CAAA,CAAA,CACF,CAAA,CACF,EAEAW,EAAAA,KAAC,MAAA,CAAI,UAAU,mBACb,SAAA,CAAAC,EAAAA,IAACW,GAAA,CAAa,UAAU,yDAAA,CAA0D,EAClFX,EAAAA,IAAC,KAAA,CAAG,UAAU,yDAAyD,SAAA,iBAAc,QACpF,IAAA,CAAE,UAAU,mCACV,SAAApE,EAAc,mCAAqC,wCAAA,CACtD,CAAA,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,EACF,EAGIgF,GAAkB,UAEnB,MAAA,CAAI,UAAU,oBACb,SAAAb,EAAAA,KAAC,MAAA,CAAI,UAAU,iGACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,2DAA2D,SAAA,kBAAe,SAEvF,OAAA,CAAK,SAAU5C,EAAaiB,EAAQ,EAAG,UAAU,YAEhD,SAAA,CAAA0B,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,eAEnF,EACAA,EAAAA,IAAC,QAAA,CACC,KAAK,OACJ,GAAG9C,EAAS,QAAS,CACpB,SAAU,yBACV,UAAW,CAAE,MAAO,EAAG,QAAS,qCAAA,EAChC,UAAW,CAAE,MAAO,IAAK,QAAS,sCAAA,CAAuC,CAC1E,EACD,YAAY,sBACZ,UAAU,2LAAA,CAAA,EAEXK,EAAO,OACNyC,MAAC,IAAA,CAAE,UAAU,8CAA+C,SAAAzC,EAAO,MAAM,OAAA,CAAQ,CAAA,EAErF,SAGC,MAAA,CACC,SAAA,CAAAyC,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,cAEnF,EACAA,EAAAA,IAAC,WAAA,CACE,GAAG9C,EAAS,cAAe,CAC1B,UAAW,CAAE,MAAO,IAAM,QAAS,6CAAA,CAA8C,CAClF,EACD,KAAM,EACN,YAAY,uCACZ,UAAU,2LAAA,CAAA,EAEXK,EAAO,aACNyC,MAAC,IAAA,CAAE,UAAU,8CAA+C,SAAAzC,EAAO,YAAY,OAAA,CAAQ,CAAA,EAE3F,SAGC,MAAA,CACC,SAAA,CAAAyC,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,iBAEnF,EACAA,EAAAA,IAAC,MAAA,CAAI,UAAU,YACZ,SAAAtC,EAAO,IAAI,CAACmD,EAAOC,IAClBf,EAAAA,KAAC,MAAA,CAAmB,UAAU,8BAC5B,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,OACJ,GAAG9C,EAAS,WAAW4D,CAAK,QAAS,CACpC,SAAUA,EAAQ,EAAI,qBAAuB,GAC7C,UAAW,CAAE,MAAO,IAAK,QAAS,uCAAA,CAAwC,CAC3E,EACD,YAAa,UAAUA,EAAQ,CAAC,GAAGA,EAAQ,EAAI,cAAgB,EAAE,GACjE,UAAU,2LAAA,CAAA,EAEXvD,EAAO,UAAUuD,CAAK,GAAG,MACxBd,EAAAA,IAAC,IAAA,CAAE,UAAU,8CACV,SAAAzC,EAAO,QAAQuD,CAAK,GAAG,MAAM,OAAA,CAChC,CAAA,EAEJ,EACCpD,EAAO,OAAS,GACfsC,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAMpC,GAAOkD,CAAK,EAC3B,UAAU,kGAEV,SAAAd,EAAAA,IAACe,EAAA,CAAU,UAAU,SAAA,CAAU,CAAA,CAAA,CACjC,CAAA,EAxBMF,EAAM,EA0BhB,CACD,EACH,EAECnD,EAAO,OAAS,IACfqC,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAMpC,EAAO,CAAE,KAAM,GAAI,EAClC,UAAU,mIAEV,SAAA,CAAAqC,EAAAA,IAACgB,EAAA,CAAS,UAAU,SAAA,CAAU,EAC9BhB,EAAAA,IAAC,QAAK,SAAA,YAAA,CAAU,CAAA,CAAA,CAAA,CAClB,EAEJ,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,uDAAuD,SAAA,gBAAa,EAElFD,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,GAAG,gBACF,GAAG9C,EAAS,eAAe,EAC5B,UAAU,gFAAA,CAAA,QAEX,QAAA,CAAM,QAAQ,gBAAgB,UAAU,2CAA2C,SAAA,2BAAA,CAEpF,CAAA,EACF,EAEA6C,EAAAA,KAAC,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,WACL,GAAG,cACF,GAAG9C,EAAS,aAAa,EAC1B,UAAU,gFAAA,CAAA,QAEX,QAAA,CAAM,QAAQ,cAAc,UAAU,2CAA2C,SAAA,kBAAA,CAElF,CAAA,CAAA,CACF,CAAA,EACF,SAGC,MAAA,CACC,SAAA,CAAA8C,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,6BAEnF,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,iBACJ,GAAG9C,EAAS,YAAa,CACxB,SAAW+D,GACLA,GAAS,IAAI,KAAKA,CAAK,GAAK,IAAI,KAC3B,wCAEF,EACT,CACD,EACD,QAAS,KAAA,EAAO,cAAc,MAAM,EAAG,EAAE,EACzC,UAAU,iMAAA,CAAA,EAEZjB,EAAAA,IAACkB,EAAA,CAAa,UAAU,0EAAA,CAA2E,CAAA,EACrG,EACC3D,EAAO,WACNyC,MAAC,IAAA,CAAE,UAAU,8CAA+C,SAAAzC,EAAO,UAAU,OAAA,CAAQ,EAEvFyC,EAAAA,IAAC,IAAA,CAAE,UAAU,gDAAgD,SAAA,+BAAA,CAE7D,CAAA,EACF,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAM1C,EAAA,EACf,UAAU,8JACX,SAAA,YAAA,CAAA,EAID0C,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,SAAUxC,EACV,UAAU,8JAET,WACCuC,EAAAA,KAAAS,EAAAA,SAAA,CACE,SAAA,CAAAR,EAAAA,IAAC,MAAA,CAAI,UAAU,8EAAA,CAA+E,EAC9FA,EAAAA,IAAC,QAAK,SAAA,aAAA,CAAW,CAAA,CAAA,CACnB,EAEAD,EAAAA,KAAAS,EAAAA,SAAA,CACE,SAAA,CAAAR,EAAAA,IAACgB,EAAA,CAAS,UAAU,SAAA,CAAU,EAC9BhB,EAAAA,IAAC,QAAK,SAAA,aAAA,CAAW,CAAA,CAAA,CACnB,CAAA,CAAA,CAEJ,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CACF,EAIJ,OACED,EAAAA,KAAC,MAAA,CAAI,UAAU,2CAEb,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,oFACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,8CACb,SAAA,CAAAC,MAAC,MAAA,CAAI,UAAU,oCACb,SAAAD,EAAAA,KAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,mDAAmD,SAAA,kBAAe,EAChFA,EAAAA,IAAC,IAAA,CAAE,UAAU,mCAAmC,SAAA,mCAAA,CAEhD,CAAA,CAAA,CACF,CAAA,CACF,EAGAA,EAAAA,IAAC,MAAA,CAAI,UAAU,sBACZ,SAAA,CACC,CAAE,GAAI,SAAU,MAAO,cAAA,EACvB,GAAIzE,GAAM,OAAS,eAAiBA,GAAM,OAAS,cAC/C,CAAC,CAAE,GAAI,SAAU,MAAO,aAAA,CAAe,EACvC,CAAA,CAAC,EAEL,IAAK4F,GACLnB,EAAAA,IAAC,SAAA,CAEC,QAAS,IAAMtE,EAAayF,EAAI,EAAS,EACzC,UAAW,8DACT1F,IAAc0F,EAAI,GACd,mDACA,kGACN,GAEC,SAAAA,EAAI,KAAA,EARAA,EAAI,EAAA,CAUZ,CAAA,CACH,CAAA,CAAA,CACF,CAAA,CACF,EAGAnB,EAAAA,IAAC,MAAA,CAAI,UAAU,8CACb,SAAAD,EAAAA,KAACqB,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,EAAG,EAAG,EAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,WAAY,CAAE,SAAU,EAAA,EAEvB,SAAA,CAAA3F,IAAc,UAAYqE,GAAA,EAC1BrE,IAAc,WAAaF,GAAM,OAAS,eAAiBA,GAAM,OAAS,gBAAkBqF,GAAA,CAAgB,CAAA,EANxGnF,CAAA,EAQT,EAGAuE,EAAAA,IAACqB,GACE,SAAAnF,GACC8D,EAAAA,IAACoB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,KAAM,CAAE,QAAS,CAAA,EACjB,UAAU,iFACV,QAAS,IAAMjF,EAAe,IAAI,EAElC,SAAA4D,EAAAA,KAACqB,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,CAAA,EACjC,QAAS,CAAE,MAAO,EAAG,QAAS,CAAA,EAC9B,KAAM,CAAE,MAAO,IAAM,QAAS,CAAA,EAC9B,QAAUlB,GAAMA,EAAE,gBAAA,EAClB,UAAU,yFAEV,SAAA,CAAAH,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,sDAAsD,SAAA,cAAW,EAC/EA,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM7D,EAAe,IAAI,EAClC,UAAU,6DAEV,SAAA6D,EAAAA,IAACe,EAAA,CAAU,UAAU,SAAA,CAAU,CAAA,CAAA,CACjC,EACF,SAEC,OAAA,CAAK,SAAUhD,EAAmBsB,CAAc,EAAG,UAAU,YAE5D,SAAA,CAAAU,OAAC,MAAA,CACC,SAAA,CAAAC,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,eAEnF,EACAA,EAAAA,IAAC,QAAA,CACC,KAAK,OACJ,GAAGlC,EAAe,QAAS,CAC1B,SAAU,yBACV,UAAW,CAAE,MAAO,EAAG,QAAS,qCAAA,EAChC,UAAW,CAAE,MAAO,IAAK,QAAS,sCAAA,CAAuC,CAC1E,EACD,YAAY,sBACZ,UAAU,2LAAA,CAAA,EAEXK,EAAa,OACZ6B,MAAC,IAAA,CAAE,UAAU,8CAA+C,SAAA7B,EAAa,MAAM,OAAA,CAAQ,CAAA,EAE3F,SAGC,MAAA,CACC,SAAA,CAAA6B,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,cAEnF,EACAA,EAAAA,IAAC,WAAA,CACE,GAAGlC,EAAe,cAAe,CAChC,UAAW,CAAE,MAAO,IAAM,QAAS,6CAAA,CAA8C,CAClF,EACD,KAAM,EACN,YAAY,uCACZ,UAAU,2LAAA,CAAA,EAEXK,EAAa,aACZ6B,MAAC,IAAA,CAAE,UAAU,8CAA+C,SAAA7B,EAAa,YAAY,OAAA,CAAQ,CAAA,EAEjG,SAGC,MAAA,CACC,SAAA,CAAA6B,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,kCAEnF,EAGAA,EAAAA,IAAC,MAAA,CAAI,UAAU,iBACZ,SAAA9D,EAAY,SAAS,IAAI,CAACsC,EAAQsC,IACjCd,EAAAA,IAAC,MAAA,CAAoB,UAAW,yBAC9B1D,EAAgB,SAASkC,EAAO,EAAE,EAC9B,kEACA,kEACN,GACE,SAAAuB,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,SACb,SAAA,CAAAA,EAAAA,KAAC,OAAA,CAAK,UAAW,WACfzD,EAAgB,SAASkC,EAAO,EAAE,EAC9B,8CACA,+BACN,GACG,SAAA,CAAAsC,EAAQ,EAAE,KAAGtC,EAAO,IAAA,EACvB,EACAuB,EAAAA,KAAC,OAAA,CAAK,UAAU,gDAAgD,SAAA,CAAA,IAC5DvB,EAAO,WAAa,EAAE,SAAA,CAAA,CAC1B,CAAA,EACF,EACCjD,GAAM,OAAS,eACdyE,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAM,CACT1D,EAAgB,SAASkC,EAAO,EAAE,EACpCjC,KAA2B2C,EAAK,UAAaoC,IAAO9C,EAAO,EAAE,CAAC,EAE9DjC,KAA2B,CAAC,GAAG2C,EAAMV,EAAO,EAAE,CAAC,CAEnD,EACA,UAAW,eACTlC,EAAgB,SAASkC,EAAO,EAAE,EAC9B,0DACA,mDACN,GACA,MAAOlC,EAAgB,SAASkC,EAAO,EAAE,EAAI,iBAAmB,gBAE/D,SAAAlC,EAAgB,SAASkC,EAAO,EAAE,EACjCwB,EAAAA,IAACgB,EAAA,CAAS,UAAU,SAAA,CAAU,EAE9BhB,EAAAA,IAACe,EAAA,CAAU,UAAU,SAAA,CAAU,CAAA,CAAA,CAEnC,CAAA,CAEJ,CAAA,EA1CQvC,EAAO,EA2CjB,CACD,CAAA,CACH,EAGCjD,GAAM,OAAS,eACdwE,EAAAA,KAAC,MAAA,CACC,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,uDAAuD,SAAA,kBAAe,EACtFD,EAAAA,KAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAM1D,EAAc6C,GAAQ,CAAC,GAAGA,EAAM,CAAE,KAAM,EAAA,CAAI,CAAC,EAC5D,UAAU,2FAEV,SAAA,CAAAc,EAAAA,IAACgB,EAAA,CAAS,UAAU,SAAA,CAAU,EAC9BhB,EAAAA,IAAC,QAAK,SAAA,YAAA,CAAU,CAAA,CAAA,CAAA,CAClB,EACF,EAEC5D,EAAW,OAAS,GACnB4D,EAAAA,IAAC,OAAI,UAAU,YACZ,SAAA5D,EAAW,IAAI,CAACoC,EAAQsC,IACvBf,EAAAA,KAAC,MAAA,CAAgB,UAAU,8BACzB,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,MAAOxB,EAAO,KACd,SAAW0B,GAAM,CACf,MAAMqB,EAAU,CAAC,GAAGnF,CAAU,EAC9BmF,EAAQT,CAAK,EAAI,CAAE,KAAMZ,EAAE,OAAO,KAAA,EAClC7D,EAAckF,CAAO,CACvB,EACA,YAAa,cAAcT,EAAQ,CAAC,GACpC,UAAU,2LAAA,CAAA,EAEZd,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAM,CACb3D,EAAc6C,GAAQA,EAAK,OAAO,CAACkB,EAAGC,IAAMA,IAAMS,CAAK,CAAC,CAC1D,EACA,UAAU,wDAEV,SAAAd,EAAAA,IAACU,EAAA,CAAU,UAAU,SAAA,CAAU,CAAA,CAAA,CACjC,CAAA,EApBQI,CAqBV,CACD,CAAA,CACH,CAAA,EAEJ,GAGAxE,EAAgB,OAAS,GAAKF,EAAW,KAAKmD,GAAOA,EAAI,KAAK,KAAA,CAAM,IACpES,EAAAA,IAAC,MAAA,CAAI,UAAU,yGACb,SAAAA,EAAAA,IAAC,KAAE,UAAU,+CAA+C,wFAE5D,CAAA,CACF,CAAA,EAEJ,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAC,EAAAA,IAAC,KAAA,CAAG,UAAU,uDAAuD,SAAA,mBAAgB,EAErFD,EAAAA,KAAC,MAAA,CAAI,UAAU,uDACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,uDAAuD,SAAA,aAAU,QAChF,OAAA,CAAK,UAAU,wCACb,SAAA9D,GAAa,cAAgB,kBAAoB,eAAA,CACpD,CAAA,EACF,EAEA6D,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,uDAAuD,SAAA,eAAY,QAClF,OAAA,CAAK,UAAU,wCACb,SAAA9D,GAAa,YAAc,YAAc,QAAA,CAC5C,CAAA,EACF,EAEA6D,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,EAAAA,IAAC,OAAA,CAAK,UAAU,uDAAuD,SAAA,kBAAe,EACtFA,EAAAA,IAAC,OAAA,CAAK,UAAW,uBACf9D,GAAa,SAAW,qCAAuC,gCACjE,GACG,SAAAA,GAAa,SAAW,SAAW,UAAA,CACtC,CAAA,EACF,EAEA8D,EAAAA,IAAC,OAAI,UAAU,8FACb,eAAC,IAAA,CAAE,UAAU,2CAA2C,SAAA,gJAAA,CAGxD,CAAA,CACF,CAAA,CAAA,CACF,CAAA,EACF,SAGC,MAAA,CACC,SAAA,CAAAA,EAAAA,IAAC,QAAA,CAAM,UAAU,kEAAkE,SAAA,6BAEnF,EACAD,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAC,EAAAA,IAAC,QAAA,CACC,KAAK,iBACJ,GAAGlC,EAAe,YAAa,CAC9B,SAAWmD,GACLA,GAAS,IAAI,KAAKA,CAAK,GAAK,IAAI,KAC3B,wCAEF,EACT,CACD,EACD,QAAS,KAAA,EAAO,cAAc,MAAM,EAAG,EAAE,EACzC,UAAU,iMAAA,CAAA,EAEZjB,EAAAA,IAACkB,EAAA,CAAa,UAAU,0EAAA,CAA2E,CAAA,EACrG,EACC/C,EAAa,WACZ6B,MAAC,IAAA,CAAE,UAAU,8CAA+C,SAAA7B,EAAa,UAAU,OAAA,CAAQ,EAE7F6B,EAAAA,IAAC,IAAA,CAAE,UAAU,gDAAgD,SAAA,+BAAA,CAE7D,CAAA,EACF,EAGAD,EAAAA,KAAC,MAAA,CAAI,UAAU,uFACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,QAAS,IAAM7D,EAAe,IAAI,EAClC,UAAU,8JACX,SAAA,QAAA,CAAA,EAID6D,EAAAA,IAAC,SAAA,CACC,KAAK,SACL,SAAU5B,EACV,UAAU,8JAET,WACC2B,EAAAA,KAAAS,EAAAA,SAAA,CACE,SAAA,CAAAR,EAAAA,IAAC,MAAA,CAAI,UAAU,8EAAA,CAA+E,EAC9FA,EAAAA,IAAC,QAAK,SAAA,aAAA,CAAW,CAAA,CAAA,CACnB,EAEAD,EAAAA,KAAAS,EAAAA,SAAA,CACE,SAAA,CAAAR,EAAAA,IAACS,EAAA,CAAW,UAAU,SAAA,CAAU,EAChCT,EAAAA,IAAC,QAAK,SAAA,aAAA,CAAW,CAAA,CAAA,CACnB,CAAA,CAAA,CAEJ,CAAA,CACF,CAAA,CAAA,CACF,CAAA,CAAA,CAAA,CACF,CAAA,EAGN,EAGAA,EAAAA,IAACqB,GACE,SAAArF,GACCgE,EAAAA,IAACoB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,KAAM,CAAE,QAAS,CAAA,EACjB,UAAU,iFACV,QAAS,IAAMnF,EAAqB,IAAI,EAExC,SAAA8D,EAAAA,KAACqB,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,CAAA,EACjC,QAAS,CAAE,MAAO,EAAG,QAAS,CAAA,EAC9B,KAAM,CAAE,MAAO,IAAM,QAAS,CAAA,EAC9B,QAAUlB,GAAMA,EAAE,gBAAA,EAClB,UAAU,2DAEV,SAAA,CAAAH,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAACwB,EAAA,CAAwB,UAAU,6CAAA,CAA8C,QAChF,KAAA,CAAG,UAAU,sDACX,SAAAxF,EAAkB,YAAc,oBAAsB,aAAA,CACzD,CAAA,EACF,EAEAgE,MAAC,IAAA,CAAE,UAAU,wCACV,WAAkB,YACf,8FAA8FhE,EAAkB,KAAK,KAAK,mCAC1H,oCAAoCA,EAAkB,KAAK,KAAK,mCAEtE,EAEA+D,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM/D,EAAqB,IAAI,EACxC,UAAU,qKACX,SAAA,QAAA,CAAA,EAGD+D,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMJ,GAAiB5D,EAAkB,KAAMA,EAAkB,WAAW,EACrF,UAAU,uFAET,SAAAA,EAAkB,YAAc,eAAiB,QAAA,CAAA,CACpD,CAAA,CACF,CAAA,CAAA,CAAA,CACF,CAAA,EAGN,EAGAgE,EAAAA,IAACqB,GACE,SAAA7E,GACCwD,EAAAA,IAACoB,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,CAAA,EACpB,QAAS,CAAE,QAAS,CAAA,EACpB,KAAM,CAAE,QAAS,CAAA,EACjB,UAAU,iFACV,QAAS,IAAM3E,EAAsB,EAAK,EAE1C,SAAAsD,EAAAA,KAACqB,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,IAAM,QAAS,CAAA,EACjC,QAAS,CAAE,MAAO,EAAG,QAAS,CAAA,EAC9B,KAAM,CAAE,MAAO,IAAM,QAAS,CAAA,EAC9B,QAAUlB,GAAMA,EAAE,gBAAA,EAClB,UAAU,2DAEV,SAAA,CAAAH,EAAAA,KAAC,MAAA,CAAI,UAAU,yBACb,SAAA,CAAAC,EAAAA,IAACwB,EAAA,CAAwB,UAAU,mDAAA,CAAoD,EACvFxB,EAAAA,IAAC,KAAA,CAAG,UAAU,sDAAsD,SAAA,4BAAA,CAEpE,CAAA,EACF,EAEAD,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAC,EAAAA,IAAC,IAAA,CAAE,UAAU,mCAAmC,SAAA,0EAEhD,EAEC1D,EAAgB,OAAS,GACxByD,EAAAA,KAAC,MAAA,CAAI,UAAU,wFACb,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,0DAA0D,SAAA,CAAA,YAC3DzD,EAAgB,OAAO,aAAA,EACnC,QACC,KAAA,CAAG,UAAU,+DACX,SAAAA,EAAgB,IAAImF,GAAY,CAC/B,MAAMjD,EAAStC,GAAa,QAAQ,KAAKqD,GAAOA,EAAI,KAAOkC,CAAQ,EACnE,cACG,KAAA,CAAkB,SAAA,CAAA,IACfjD,GAAQ,KAAK,MAAIA,GAAQ,WAAa,EAAE,SAAA,CAAA,EADnCiD,CAET,CAEJ,CAAC,CAAA,CACH,CAAA,EACF,EAGDrF,EAAW,KAAKmD,GAAOA,EAAI,KAAK,MAAM,GACrCQ,EAAAA,KAAC,MAAA,CAAI,UAAU,4FACb,SAAA,CAAAA,EAAAA,KAAC,IAAA,CAAE,UAAU,4DAA4D,SAAA,CAAA,UAC/D3D,EAAW,OAAOmD,GAAOA,EAAI,KAAK,KAAA,CAAM,EAAE,OAAO,iBAAA,EAC3D,QACC,KAAA,CAAG,UAAU,iEACX,SAAAnD,EAAW,OAAOmD,GAAOA,EAAI,KAAK,KAAA,CAAM,EAAE,IAAI,CAACf,EAAQsC,WACrD,KAAA,CAAe,SAAA,CAAA,IAAEtC,EAAO,KAAK,GAAA,CAAA,EAArBsC,CAAsB,CAChC,CAAA,CACH,CAAA,EACF,EAGFf,EAAAA,KAAC,MAAA,CAAI,UAAU,oGACb,SAAA,CAAAC,EAAAA,IAAC,KAAE,UAAU,+CACX,SAAAA,MAAC,SAAA,CAAO,yBAAa,CAAA,CACvB,EACAD,EAAAA,KAAC,KAAA,CAAG,UAAU,oFACZ,SAAA,CAAAC,EAAAA,IAAC,MAAG,SAAA,6DAAA,CAA2D,EAC/DA,EAAAA,IAAC,MAAG,SAAA,mEAAA,CAAiE,EACrEA,EAAAA,IAAC,MAAG,SAAA,gDAAA,CAA8C,EAClDA,EAAAA,IAAC,MAAG,SAAA,8BAAA,CAA4B,CAAA,CAAA,CAClC,CAAA,CAAA,CACF,CAAA,EACF,EAEAD,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAC,EAAAA,IAAC,SAAA,CACC,QAAS,IAAMvD,EAAsB,EAAK,EAC1C,UAAU,qKACX,SAAA,QAAA,CAAA,EAGDuD,EAAAA,IAAC,SAAA,CACC,QAAS,IAAM,CACbvD,EAAsB,EAAK,EAC3BsB,EAAmBsB,CAAc,EAAA,CACnC,EACA,UAAU,yGACX,SAAA,sBAAA,CAAA,CAED,CAAA,CACF,CAAA,CAAA,CAAA,CACF,CAAA,CACF,CAEJ,CAAA,EACF,CAEJ"}