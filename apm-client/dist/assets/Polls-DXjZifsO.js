import{r as c}from"./router-DFnE1L-t.js";import{j as e,m as v,A as T}from"./ui-DXG44aSJ.js";import{o as M,C as B,p as G,z as u,q as Q}from"./index-B-R1b6bD.js";import{C as z}from"./redux-DEMpy3iB.js";import{F as y}from"./ChartBarIcon-CLsU3hA-.js";import{F as O}from"./UserGroupIcon-CnvKPj6V.js";import{F as q}from"./ClockIcon-DZUckIFe.js";import{F as f}from"./CheckCircleIcon-DCBCeWMH.js";import{F as N,a as p}from"./ChevronUpIcon-OweSaa88.js";import{F as H}from"./EyeIcon-Bt_hkgUK.js";import{f as w}from"./utils-DC-dt1nQ.js";function W({title:d,titleId:o,...n},x){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":o},n),d?c.createElement("title",{id:o},d):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 1 1 0-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 0 1-1.44-4.282m3.102.069a18.03 18.03 0 0 1-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 0 1 8.835 2.535M10.34 6.66a23.847 23.847 0 0 0 8.835-2.535m0 0A23.74 23.74 0 0 0 18.795 3m.38 1.125a23.91 23.91 0 0 1 1.014 5.395m-1.014 8.855c-.118.38-.245.754-.38 1.125m.38-1.125a23.91 23.91 0 0 0 1.014-5.395m0-3.46c.495.413.811 1.035.811 1.73 0 .695-.316 1.317-.811 1.73m0-3.46a24.347 24.347 0 0 1 0 3.46"}))}const re=c.forwardRef(W),ie=()=>{const[d,o]=c.useState("active"),[n,x]=c.useState(null),[m,k]=c.useState(null),{user:A}=z(s=>s.auth),{data:b,isLoading:P}=M(),{data:j,isLoading:F}=B({page:1,limit:20,sortBy:"createdAt",sortOrder:"desc"}),[V]=G(),g=d==="active"?b?.activePolls:j?.polls?.filter(s=>{const t=s.expiresAt&&new Date>new Date(s.expiresAt);return!s.isActive||t}),C=d==="active"?P:F,D=async(s,t,l,r)=>{let a;l?r.includes(t)?a=r.filter(i=>i!==t):a=[...r,t]:r.includes(t)?a=[]:a=[t];try{await V({pollId:s,data:{optionIds:a}}).unwrap(),a.length===0?u.success("All votes removed successfully!"):u.success("Vote updated successfully!")}catch(i){console.error("Vote error:",i),u.error("Failed to update vote")}},E=s=>{x(n===s?null:s)},$=s=>{k(m===s?null:s)},R=({poll:s})=>{const t=s.expiresAt&&new Date>new Date(s.expiresAt),l=s.isActive&&!t&&A;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.totalVotes," votes"]})]}),s.expiresAt&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:t?"Expired":`Expires ${w(new Date(s.expiresAt))} from now`})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.hasVoted&&e.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{children:"Voted"})]}),e.jsxs("button",{onClick:()=>E(s.id),className:"flex items-center space-x-1 px-2 py-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Stats"}),n===s.id?e.jsx(N,{className:"h-3 w-3"}):e.jsx(p,{className:"h-3 w-3"})]})]})]})]}),e.jsx("div",{className:"space-y-3 mb-4",children:s.options.map(r=>{const a=s.userVote?.includes(r.id),i=s.hasVoted||!s.isActive||t,L=i?(h=>h>=60?"bg-green-200 border-green-400 text-green-900":h>=40?"bg-yellow-200 border-yellow-400 text-yellow-900":h>=20?"bg-orange-200 border-orange-400 text-orange-900":"bg-red-200 border-red-400 text-red-900")(r.percentage):"";return e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:()=>l&&D(s.id,r.id,s.allowMultiple,s.userVote||[]),disabled:!l,className:`w-full p-3 rounded-lg border text-left transition-all relative overflow-hidden ${a?"border-green-300 bg-green-50 text-green-800":l?"border-gray-300 hover:border-blue-400 hover:bg-blue-50":i?L:"border-gray-200"}`,children:[i&&e.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:`linear-gradient(to right, currentColor ${r.percentage}%, transparent ${r.percentage}%)`}}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:r.text}),a&&e.jsx(f,{className:"h-4 w-4 text-green-600"})]}),i&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsxs("span",{children:[r.voteCount," votes"]}),e.jsxs("span",{className:"font-semibold",children:[r.percentage,"%"]})]})]})]})},r.id)})}),e.jsx(S,{pollId:s.id,isExpanded:n===s.id})]})},S=({pollId:s,isExpanded:t})=>{const{data:l,isLoading:r}=Q(s,{skip:!t});return t?e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"border-t border-gray-200 dark:border-gray-700 pt-4 overflow-hidden",children:r?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.totalVotes}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Votes"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.totalVoters}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Voters"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Vote Breakdown"]}),l.options.map(a=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:a.text}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm",children:[a.voteCount," votes"]}),e.jsxs("span",{className:"font-bold",children:[a.percentage,"%"]})]})]}),!l.poll.isAnonymous&&a.voters.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{onClick:()=>$(a.id),className:"flex items-center justify-between w-full text-sm p-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-600 dark:hover:bg-gray-500 rounded border border-gray-300 dark:border-gray-500 transition-colors",children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:["Voted by (",a.voters.length,")"]}),m===a.id?e.jsx(N,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"}):e.jsx(p,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"})]}),e.jsx(T,{children:m===a.id&&e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-2 overflow-hidden",children:e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:a.voters.map(i=>e.jsxs("div",{className:"flex items-center justify-between text-xs p-2 bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-medium",children:i.fullName.charAt(0)}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium",children:i.fullName}),i.batch&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["(",i.batch,")"]})]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[w(new Date(i.votedAt))," ago"]})]},i.id))})})})]})]})},a.id))]}),l.poll.isAnonymous&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-2",children:[e.jsx(H,{className:"h-5 w-5 mx-auto mb-1"}),"This poll is anonymous - voter details are hidden"]})]}):e.jsx("div",{className:"text-center text-gray-500 py-4",children:"Failed to load statistics"})}):null};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Polls"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vote on community polls and see detailed statistics"})]}),e.jsx("div",{className:"flex space-x-6 mb-6 border-b border-gray-200 dark:border-gray-700",children:[{id:"active",label:"Active Polls",count:b?.count},{id:"all",label:"All Polls",count:j?.polls?.filter(s=>{const t=s.expiresAt&&new Date>new Date(s.expiresAt);return!s.isActive||t})?.length}].map(s=>e.jsxs("button",{onClick:()=>o(s.id),className:`pb-3 px-1 border-b-2 font-medium transition-colors ${d===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[s.label,s.count!==void 0&&e.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded-full",children:s.count})]},s.id))}),C?e.jsx("div",{className:"space-y-6",children:[...Array(3)].map((s,t)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]},t))}):g&&g.length>0?e.jsx("div",{className:"space-y-6",children:g.map(s=>e.jsx(R,{poll:s},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(y,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:d==="active"?"No Active Polls":"No Polls Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:d==="active"?"There are no active polls at the moment.":"No polls have been created yet."})]})]})})};export{re as F,ie as P};
//# sourceMappingURL=Polls-DXjZifsO.js.map
