import{j as e,m as b,A as T}from"./ui-BlmhFX_F.js";import{r as m}from"./router-DFnE1L-t.js";import{Q,Z as G,R as z,z as g,S as B}from"./index-P8gjH_om.js";import{C as M}from"./redux-VN59sPcb.js";import{F as h}from"./ChartBarIcon-CLsU3hA-.js";import{F as O}from"./UserGroupIcon-CnvKPj6V.js";import{F as Z}from"./ClockIcon-DZUckIFe.js";import{F as j}from"./CheckCircleIcon-DCBCeWMH.js";import{F as v}from"./ChevronUpIcon-De_BqJq8.js";import{F as N}from"./ChevronDownIcon-qIBcN2qV.js";import{F as _}from"./EyeIcon-Bt_hkgUK.js";import{a as f}from"./utils-CXyNmL__.js";const re=()=>{const[l,p]=m.useState("active"),[c,w]=m.useState(null),[n,k]=m.useState(null),{user:A}=M(s=>s.auth),{data:u,isLoading:P}=Q(),{data:y,isLoading:V}=G({page:1,limit:20,sortBy:"createdAt",sortOrder:"desc"}),[F]=z(),o=l==="active"?u?.activePolls:y?.polls?.filter(s=>{const t=s.expiresAt&&new Date>new Date(s.expiresAt);return!s.isActive||t}),C=l==="active"?P:V,D=async(s,t,d,r)=>{let a;d?r.includes(t)?a=r.filter(i=>i!==t):a=[...r,t]:r.includes(t)?a=[]:a=[t];try{await F({pollId:s,data:{optionIds:a}}).unwrap(),a.length===0?g.success("All votes removed successfully!"):g.success("Vote updated successfully!")}catch(i){console.error("Vote error:",i),g.error("Failed to update vote")}},S=s=>{w(c===s?null:s)},$=s=>{k(n===s?null:s)},R=({poll:s})=>{const t=s.expiresAt&&new Date>new Date(s.expiresAt),d=s.isActive&&!t&&A;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:s.title}),s.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.totalVotes," votes"]})]}),s.expiresAt&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:t?"Expired":`Expires ${f(new Date(s.expiresAt))} from now`})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.hasVoted&&e.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{children:"Voted"})]}),e.jsxs("button",{onClick:()=>S(s.id),className:"flex items-center space-x-1 px-2 py-1 text-blue-600 hover:bg-blue-50 rounded transition-colors",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx("span",{children:"Stats"}),c===s.id?e.jsx(v,{className:"h-3 w-3"}):e.jsx(N,{className:"h-3 w-3"})]})]})]})]}),e.jsx("div",{className:"space-y-3 mb-4",children:s.options.map(r=>{const a=s.userVote?.includes(r.id),i=s.hasVoted||!s.isActive||t,L=i?(x=>x>=60?"bg-green-200 border-green-400 text-green-900":x>=40?"bg-yellow-200 border-yellow-400 text-yellow-900":x>=20?"bg-orange-200 border-orange-400 text-orange-900":"bg-red-200 border-red-400 text-red-900")(r.percentage):"";return e.jsx("div",{className:"relative",children:e.jsxs("button",{onClick:()=>d&&D(s.id,r.id,s.allowMultiple,s.userVote||[]),disabled:!d,className:`w-full p-3 rounded-lg border text-left transition-all relative overflow-hidden ${a?"border-green-300 bg-green-50 text-green-800":d?"border-gray-300 hover:border-blue-400 hover:bg-blue-50":i?L:"border-gray-200"}`,children:[i&&e.jsx("div",{className:"absolute inset-0 opacity-20",style:{background:`linear-gradient(to right, currentColor ${r.percentage}%, transparent ${r.percentage}%)`}}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:r.text}),a&&e.jsx(j,{className:"h-4 w-4 text-green-600"})]}),i&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsxs("span",{children:[r.voteCount," votes"]}),e.jsxs("span",{className:"font-semibold",children:[r.percentage,"%"]})]})]})]})},r.id)})}),e.jsx(E,{pollId:s.id,isExpanded:c===s.id})]})},E=({pollId:s,isExpanded:t})=>{const{data:d,isLoading:r}=B(s,{skip:!t});return t?e.jsx(b.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"border-t border-gray-200 dark:border-gray-700 pt-4 overflow-hidden",children:r?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"})}):d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d.totalVotes}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Votes"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.totalVoters}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Voters"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white flex items-center",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Vote Breakdown"]}),d.options.map(a=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:a.text}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm",children:[a.voteCount," votes"]}),e.jsxs("span",{className:"font-bold",children:[a.percentage,"%"]})]})]}),!d.poll.isAnonymous&&a.voters.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{onClick:()=>$(a.id),className:"flex items-center justify-between w-full text-sm p-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-600 dark:hover:bg-gray-500 rounded border border-gray-300 dark:border-gray-500 transition-colors",children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-200",children:["Voted by (",a.voters.length,")"]}),n===a.id?e.jsx(v,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"}):e.jsx(N,{className:"h-4 w-4 text-gray-600 dark:text-gray-300"})]}),e.jsx(T,{children:n===a.id&&e.jsx(b.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-2 overflow-hidden",children:e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:a.voters.map(i=>e.jsxs("div",{className:"flex items-center justify-between text-xs p-2 bg-white dark:bg-gray-600 border border-gray-200 dark:border-gray-500 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-medium",children:i.fullName.charAt(0)}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200 font-medium",children:i.fullName}),i.batch&&e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:["(",i.batch,")"]})]}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[f(new Date(i.votedAt))," ago"]})]},i.id))})})})]})]})},a.id))]}),d.poll.isAnonymous&&e.jsxs("div",{className:"text-center text-gray-500 dark:text-gray-400 py-2",children:[e.jsx(_,{className:"h-5 w-5 mx-auto mb-1"}),"This poll is anonymous - voter details are hidden"]})]}):e.jsx("div",{className:"text-center text-gray-500 py-4",children:"Failed to load statistics"})}):null};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Polls"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vote on community polls and see detailed statistics"})]}),e.jsx("div",{className:"flex space-x-6 mb-6 border-b border-gray-200 dark:border-gray-700",children:[{id:"active",label:"Active Polls",count:u?.count},{id:"all",label:"All Polls",count:y?.polls?.filter(s=>{const t=s.expiresAt&&new Date>new Date(s.expiresAt);return!s.isActive||t})?.length}].map(s=>e.jsxs("button",{onClick:()=>p(s.id),className:`pb-3 px-1 border-b-2 font-medium transition-colors ${l===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[s.label,s.count!==void 0&&e.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-gray-100 dark:bg-gray-700 rounded-full",children:s.count})]},s.id))}),C?e.jsx("div",{className:"space-y-6",children:[...Array(3)].map((s,t)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]})]},t))}):o&&o.length>0?e.jsx("div",{className:"space-y-6",children:o.map(s=>e.jsx(R,{poll:s},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:l==="active"?"No Active Polls":"No Polls Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l==="active"?"There are no active polls at the moment.":"No polls have been created yet."})]})]})})};export{re as P};
//# sourceMappingURL=Polls-CR-8B56U.js.map
