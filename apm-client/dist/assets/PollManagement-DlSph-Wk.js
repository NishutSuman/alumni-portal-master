import{j as e,m as g,A as F}from"./ui-DXG44aSJ.js";import{r as n}from"./router-DFnE1L-t.js";import{u as V,a as ne}from"./index.esm-B0I9BSpA.js";import{u as ce,x as xe,y as me,A as ge,B as pe,C as ue,D as o}from"./index-B-R1b6bD.js";import{F as M}from"./XMarkIcon-D1c1wIzV.js";import{F as A}from"./PlusIcon-B6tiF6Nj.js";import{F as _}from"./TrashIcon-mpSEd7uz.js";import{F as q}from"./CalendarIcon-CroBm0p_.js";import{F as B}from"./PencilIcon-DAEDOf0J.js";import{F as z}from"./ExclamationTriangleIcon-DCwPn2ZM.js";import{F as he}from"./MagnifyingGlassIcon-C2UCCqkW.js";import{F as ye}from"./FunnelIcon-CMHiB3uy.js";import{b as be}from"./utils-DC-dt1nQ.js";import{F as fe}from"./ChartBarIcon-CLsU3hA-.js";import"./redux-DEMpy3iB.js";import"./vendor-gH-7aFTg.js";const Ie=()=>{const{user:c}=ce(),[k,O]=n.useState("manage"),[w,Q]=n.useState(""),[H,W]=n.useState({page:1,limit:20,sortBy:"createdAt",sortOrder:"desc"}),[x,y]=n.useState(null),[i,b]=n.useState(null),[d,f]=n.useState([]),[l,N]=n.useState([]),[T,p]=n.useState(!1),[G]=xe(),[Y]=me(),[R]=ge(),[J]=pe(),{register:u,control:K,handleSubmit:X,watch:je,reset:$,formState:{errors:m,isSubmitting:E}}=V({defaultValues:{title:"",description:"",options:[{text:""},{text:""}],allowMultiple:!1,isAnonymous:!1,expiresAt:""}}),{fields:P,append:Z,remove:ee}=ne({control:K,name:"options"}),{register:C,handleSubmit:U,reset:te,setValue:D,getValues:ke,formState:{errors:h,isSubmitting:I}}=V(),re=async t=>{try{const r=t.options.filter(a=>a.text.trim());if(r.length<2){o.error("Please provide at least 2 options");return}const s={title:t.title,description:t.description,options:r.map(a=>a.text),allowMultiple:t.allowMultiple,isAnonymous:t.isAnonymous,...t.expiresAt&&{expiresAt:new Date(t.expiresAt).toISOString()}};console.log("Sending poll data:",s),await J(s).unwrap(),o.success("Poll created successfully! All users have been notified."),$(),O("manage"),v()}catch(r){console.error("Create poll error:",r),o.error(r?.data?.message||"Failed to create poll")}},{data:S,isLoading:ae,refetch:v}=ue(H);n.useEffect(()=>{const t=setTimeout(()=>{W(r=>({...r,search:w.trim(),page:1}))},500);return()=>clearTimeout(t)},[w]);const se=t=>{b(t),f([]),N([]),p(!1),D("title",t.title),D("description",t.description||""),D("expiresAt",t.expiresAt?new Date(t.expiresAt).toISOString().slice(0,16):"")},L=async t=>{if(!i)return;i.totalVotes>0;const r=d.some(a=>a.text.trim());if((l.length>0||r)&&!T){p(!0);return}try{const a={title:t.title,description:t.description,...t.expiresAt&&{expiresAt:new Date(t.expiresAt).toISOString()},...d.length>0&&{addOptions:d.map(j=>j.text).filter(j=>j.trim())},...l.length>0&&{removeOptionIds:l}};console.log("ðŸ” Frontend update data:",{updateData:a,newOptions:d,optionsToRemove:l,pollId:i.id}),await R({pollId:i.id,data:a}).unwrap(),o.success("Poll updated successfully!"),b(null),f([]),N([]),p(!1),te(),v()}catch(a){console.error("Update poll error:",a),o.error(a?.data?.message||"Failed to update poll")}},le=async t=>{try{const r=await R({pollId:t.id,data:{isActive:!t.isActive}}).unwrap();o.success(`Poll ${t.isActive?"deactivated":"activated"} successfully`),v()}catch(r){o.error(r?.data?.message||"Failed to update poll status")}},ie=async(t,r=!1)=>{try{r?(await Y(t.id).unwrap(),o.success("Poll force deleted successfully")):(await G(t.id).unwrap(),o.success("Poll deleted successfully")),y(null),v()}catch(s){s?.data?.message?.includes("votes")?y({poll:t,forceDelete:!0}):o.error(s?.data?.message||"Failed to delete poll")}},de=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search polls...",value:w,onChange:t=>Q(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("button",{className:"flex items-center space-x-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(ye,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"All Polls"})}),ae?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"animate-pulse space-y-4",children:[...Array(5)].map((t,r)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded flex-1"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"})]},r))})}):S?.polls&&S.polls.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Poll"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Creator"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Votes"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:S.polls.map(t=>{const r=t.expiresAt&&new Date>new Date(t.expiresAt);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.title}),t.description&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs",children:t.description})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.creator.fullName}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Batch ",t.creator.batch]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:t.totalVotes}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${r?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-300":t.isActive?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"}`,children:r?"Expired":t.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:be(new Date(t.createdAt),"MMM d, yyyy")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("div",{className:"flex items-center justify-end space-x-2",children:(c?.role==="SUPER_ADMIN"||t.createdBy===c?.id)&&e.jsxs(e.Fragment,{children:[!r&&e.jsx("button",{onClick:()=>se(t),className:"text-yellow-600 dark:text-yellow-400 hover:text-yellow-900 dark:hover:text-yellow-300",title:"Edit Poll",children:e.jsx(B,{className:"h-4 w-4"})}),!r&&e.jsx("button",{onClick:()=>le(t),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${t.isActive?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-800":"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-800"}`,title:t.isActive?"Deactivate Poll":"Activate Poll",children:t.isActive?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>y({poll:t,forceDelete:!1}),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",title:"Delete Poll",children:e.jsx(_,{className:"h-4 w-4"})})]})})})]},t.id)})})]})}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(fe,{className:"h-12 w-12 text-gray-400 dark:text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No polls found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:w?"Try adjusting your search terms.":"Create your first poll to get started."})]})]})]}),oe=()=>e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Create New Poll"}),e.jsxs("form",{onSubmit:X(re),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Poll Title *"}),e.jsx("input",{type:"text",...u("title",{required:"Poll title is required",minLength:{value:3,message:"Title must be at least 3 characters"},maxLength:{value:200,message:"Title must not exceed 200 characters"}}),placeholder:"Enter poll title...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),m.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:m.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{...u("description",{maxLength:{value:1e3,message:"Description must not exceed 1000 characters"}}),rows:3,placeholder:"Enter poll description (optional)...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),m.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:m.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Poll Options *"}),e.jsx("div",{className:"space-y-3",children:P.map((t,r)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",...u(`options.${r}.text`,{required:r<2?"Option is required":!1,maxLength:{value:200,message:"Option must not exceed 200 characters"}}),placeholder:`Option ${r+1}${r<2?" (required)":""}`,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),m.options?.[r]?.text&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:m.options[r]?.text?.message})]}),P.length>2&&e.jsx("button",{type:"button",onClick:()=>ee(r),className:"p-2 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 transition-colors",children:e.jsx(M,{className:"h-5 w-5"})})]},t.id))}),P.length<10&&e.jsxs("button",{type:"button",onClick:()=>Z({text:""}),className:"mt-3 flex items-center space-x-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Option"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Poll Settings"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"allowMultiple",...u("allowMultiple"),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"allowMultiple",className:"text-sm text-gray-700 dark:text-gray-300",children:"Allow multiple selections"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:"isAnonymous",...u("isAnonymous"),className:"rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"isAnonymous",className:"text-sm text-gray-700 dark:text-gray-300",children:"Anonymous voting"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Expiration Date (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"datetime-local",...u("expiresAt",{validate:t=>t&&new Date(t)<=new Date?"Expiration date must be in the future":!0}),min:new Date().toISOString().slice(0,16),className:"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"})]}),m.expiresAt&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:m.expiresAt.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Leave empty for no expiration"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>$(),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Reset Form"}),e.jsx("button",{type:"submit",disabled:E,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Creating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Poll"})]})})]})]})]})});return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Poll Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create and manage community polls"})]})}),e.jsx("div",{className:"mt-6 flex space-x-8",children:[{id:"manage",label:"Manage Polls"},...c?.role==="SUPER_ADMIN"||c?.role==="BATCH_ADMIN"?[{id:"create",label:"Create Poll"}]:[]].map(t=>e.jsx("button",{onClick:()=>O(t.id),className:`pb-2 px-1 border-b-2 font-medium text-sm transition-colors ${k===t.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"}`,children:t.label},t.id))})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:[k==="manage"&&de(),k==="create"&&(c?.role==="SUPER_ADMIN"||c?.role==="BATCH_ADMIN")&&oe()]},k)}),e.jsx(F,{children:i&&e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>b(null),children:e.jsxs(g.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Update Poll"}),e.jsx("button",{onClick:()=>b(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(M,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:U(L),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Poll Title *"}),e.jsx("input",{type:"text",...C("title",{required:"Poll title is required",minLength:{value:3,message:"Title must be at least 3 characters"},maxLength:{value:200,message:"Title must not exceed 200 characters"}}),placeholder:"Enter poll title...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),h.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{...C("description",{maxLength:{value:1e3,message:"Description must not exceed 1000 characters"}}),rows:3,placeholder:"Enter poll description (optional)...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),h.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.description.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Poll Options (Admin can modify)"}),e.jsx("div",{className:"space-y-2 mb-4",children:i.options?.map((t,r)=>e.jsx("div",{className:`p-3 rounded-lg border ${l.includes(t.id)?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:`text-sm ${l.includes(t.id)?"text-red-900 dark:text-red-300 line-through":"text-gray-900 dark:text-white"}`,children:[r+1,". ",t.text]}),e.jsxs("span",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:["(",t.voteCount||0," votes)"]})]}),c?.role==="SUPER_ADMIN"&&e.jsx("button",{type:"button",onClick:()=>{l.includes(t.id)?N(s=>s.filter(a=>a!==t.id)):N(s=>[...s,t.id])},className:`p-1 rounded ${l.includes(t.id)?"text-green-600 hover:text-green-800 dark:text-green-400":"text-red-600 hover:text-red-800 dark:text-red-400"}`,title:l.includes(t.id)?"Restore option":"Remove option",children:l.includes(t.id)?e.jsx(A,{className:"h-4 w-4"}):e.jsx(M,{className:"h-4 w-4"})})]})},t.id))}),c?.role==="SUPER_ADMIN"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Add New Options"}),e.jsxs("button",{type:"button",onClick:()=>f(t=>[...t,{text:""}]),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 text-sm flex items-center space-x-1",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Add Option"})]})]}),d.length>0&&e.jsx("div",{className:"space-y-2",children:d.map((t,r)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:t.text,onChange:s=>{const a=[...d];a[r]={text:s.target.value},f(a)},placeholder:`New option ${r+1}`,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx("button",{type:"button",onClick:()=>{f(s=>s.filter((a,j)=>j!==r))},className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400",children:e.jsx(_,{className:"h-4 w-4"})})]},r))})]}),(l.length>0||d.some(t=>t.text.trim()))&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:"âš ï¸ Modifying options will affect existing voting data and notify all voters."})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Poll Information"}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Poll Type:"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:i?.allowMultiple?"Multiple Choice":"Single Choice"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Voting Type:"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:i?.isAnonymous?"Anonymous":"Public"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Current Status:"}),e.jsx("span",{className:`text-sm font-medium ${i?.isActive?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:i?.isActive?"Active":"Inactive"})]}),e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded",children:e.jsx("p",{className:"text-xs text-blue-800 dark:text-blue-300",children:"ðŸ’¡ Poll settings cannot be changed after creation to maintain data integrity. Use the Deactivate button in the poll list to disable this poll."})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Expiration Date (Optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"datetime-local",...C("expiresAt",{validate:t=>t&&new Date(t)<=new Date?"Expiration date must be in the future":!0}),min:new Date().toISOString().slice(0,16),className:"w-full px-3 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"})]}),h.expiresAt&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:h.expiresAt.message}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"Leave empty for no expiration"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>b(null),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:I,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Updating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Update Poll"})]})})]})]})]})})}),e.jsx(F,{children:x&&e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>y(null),children:e.jsxs(g.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(z,{className:"h-6 w-6 text-red-600 dark:text-red-400 mr-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:x.forceDelete?"Force Delete Poll":"Delete Poll"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:x.forceDelete?`This poll has votes and cannot be deleted normally. Are you sure you want to force delete "${x.poll.title}"? This action cannot be undone.`:`Are you sure you want to delete "${x.poll.title}"? This action cannot be undone.`}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>y(null),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>ie(x.poll,x.forceDelete),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:x.forceDelete?"Force Delete":"Delete"})]})]})})}),e.jsx(F,{children:T&&e.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>p(!1),children:e.jsxs(g.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-lg w-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(z,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400 mr-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Confirm Poll Modifications"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You are about to make changes that will affect this poll's voting data:"}),l.length>0&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-red-800 dark:text-red-300 mb-2",children:["Removing ",l.length," option(s):"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-700 dark:text-red-300",children:l.map(t=>{const r=i?.options.find(s=>s.id===t);return e.jsxs("li",{children:['"',r?.text,'" (',r?.voteCount||0," votes)"]},t)})})]}),d.some(t=>t.text.trim())&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:[e.jsxs("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-2",children:["Adding ",d.filter(t=>t.text.trim()).length," new option(s):"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-blue-700 dark:text-blue-300",children:d.filter(t=>t.text.trim()).map((t,r)=>e.jsxs("li",{children:['"',t.text,'"']},r))})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:e.jsx("strong",{children:"âš ï¸ Important:"})}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-yellow-700 dark:text-yellow-300 mt-1 space-y-1",children:[e.jsx("li",{children:"Removed options and their votes will be permanently deleted"}),e.jsx("li",{children:"All voters will receive a push notification about the poll update"}),e.jsx("li",{children:"Users can vote again on new options if allowed"}),e.jsx("li",{children:"This action cannot be undone"})]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{p(!1),U(L)()},className:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium",children:"Proceed with Changes"})]})]})})})]})};export{Ie as default};
//# sourceMappingURL=PollManagement-DlSph-Wk.js.map
