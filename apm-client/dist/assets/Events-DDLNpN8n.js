import{j as e}from"./ui-DhYQrQWF.js";import{r as n,R as Ne,e as be,b as we,u as ke}from"./router-BgvBx64T.js";import{p as te,u as Se}from"./index-CZ6-uofb.js";import{o as Re}from"./userApi-Cc4X1HnQ.js";import{L as se}from"./LoadingSpinner-r4aotE8K.js";import{E as Ee,a as De,R as Ae,Q as Ce,I as Te,T as $e}from"./TicketModal-DaFcOTmg.js";import{F as _}from"./ChevronDownIcon-Cbf4tdh_.js";import{F as J}from"./ChartBarIcon-xItc45cH.js";import{F as Z}from"./UserIcon-Bm6z4MZR.js";import{F as ae}from"./UsersIcon-B-AjT4um.js";import{F as re}from"./CurrencyRupeeIcon-DmDbs4Pp.js";import{F as Fe}from"./ChevronUpIcon-BjTUVWAQ.js";import{F as ee}from"./CalendarIcon-D1CEt3gK.js";import{F as Le}from"./ClockIcon-53QLE2kZ.js";import{F as Ie}from"./MapPinIcon-DXK1xInM.js";import{F as Y}from"./EyeIcon-DLMljlLJ.js";import{f as Me}from"./utils-CXyNmL__.js";import"./redux-CfKcOgfB.js";import"./vendor-c5ypKtDW.js";import"./XMarkIcon-B58Eb0hU.js";import"./index.esm-Gm6OHcy7.js";import"./DocumentTextIcon-CP6_YxxS.js";import"./ArrowDownTrayIcon-BpYFy8xY.js";const Pe=()=>{const[g,k]=n.useState("all"),[u,p]=n.useState("all"),[S,d]=n.useState("overview"),[o,y]=n.useState(null),[x,i]=n.useState(null),[$,F]=n.useState(!1),[L,I]=n.useState(!1),[v,M]=n.useState(null),[j,P]=n.useState("asc"),{data:R,isLoading:V}=te({page:1,limit:100,status:"PUBLISHED"}),N=R?.events||[],q=Ne.useMemo(()=>{if(!x?.registrations)return[];const s=x.registrations.map(a=>a.user?.batch).filter(a=>a!=null);return[...new Set(s)].sort((a,l)=>l-a)},[x]),A=async s=>{if(s==="all"){y(null);return}F(!0);try{const a=await fetch(`http://localhost:3000/api/events/${s}/public-analytics`,{headers:{"Content-Type":"application/json"}});if(a.ok){const l=await a.json();y(l.data)}else console.error("Failed to fetch public analytics"),y(null)}catch(a){console.error("Error fetching public analytics:",a),y(null)}finally{F(!1)}},C=async s=>{if(s==="all"){i(null);return}I(!0);try{const a=await fetch(`http://localhost:3000/api/events/${s}/public-registrations`,{headers:{"Content-Type":"application/json"}});if(a.ok){const l=await a.json();i(l.data)}else console.error("Failed to fetch public registrations"),i(null)}catch(a){console.error("Error fetching public registrations:",a),i(null)}finally{I(!1)}},E=s=>{v===s?P(j==="asc"?"desc":"asc"):(M(s),P("asc"))},O=()=>!x?.registrations||!v?x?.registrations||[]:[...x.registrations].sort((s,a)=>{let l,m;switch(v){case"batch":l=s.user?.batch||0,m=a.user?.batch||0;break;case"date":l=new Date(s.registrationDate||"").getTime(),m=new Date(a.registrationDate||"").getTime();break;case"totalAmount":l=s.totalAmount||0,m=a.totalAmount||0;break;default:return 0}return j==="asc"?l>m?1:l<m?-1:0:l<m?1:l>m?-1:0}),b=s=>{k(s),p("all"),M(null),s!=="all"?(A(s),C(s)):(y(null),i(null))},z=s=>{d(s),s==="registration"&&g!=="all"&&C(g)},D=s=>new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"2-digit",year:"2-digit"}),T=s=>`₹${s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,w=({field:s,children:a,className:l=""})=>e.jsx("th",{className:`py-4 px-4 text-gray-300 font-medium cursor-pointer hover:text-white transition-colors ${l}`,onClick:()=>E(s),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a,e.jsxs("div",{className:"flex flex-col opacity-80 hover:opacity-100",children:[e.jsx(Fe,{className:`h-4 w-4 ${v===s&&j==="asc"?"text-blue-400":"text-gray-400"}`}),e.jsx(_,{className:`h-4 w-4 -mt-1 ${v===s&&j==="desc"?"text-blue-400":"text-gray-400"}`})]})]})});return V?e.jsx(se,{}):e.jsx("div",{className:"bg-gray-900 text-white min-h-screen p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Event Analytics"})}),e.jsxs("div",{className:"flex justify-center gap-4 mb-8",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:g,onChange:s=>b(s.target.value),className:"bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 pr-10 text-white min-w-80 appearance-none focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"Default All Event"}),N.map(s=>e.jsx("option",{value:s.id,children:s.title},s.id))]}),e.jsx(_,{className:"h-5 w-5 absolute right-3 top-3 text-gray-400 pointer-events-none"})]}),g!=="all"&&q.length>0&&e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:u,onChange:s=>p(s.target.value),className:"bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 pr-10 text-white min-w-48 appearance-none focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"all",children:"Select Batch"}),q.map(s=>e.jsx("option",{value:s.toString(),children:s},s))]}),e.jsx(_,{className:"h-5 w-5 absolute right-3 top-3 text-gray-400 pointer-events-none"})]})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"flex bg-gray-800 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>z("overview"),className:`px-6 py-2 rounded-md transition-colors ${S==="overview"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:"Overview"}),e.jsx("button",{onClick:()=>z("registration"),className:`px-6 py-2 rounded-md transition-colors ${S==="registration"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:"Registration"})]})}),g==="all"?e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-8",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Select an Event"}),e.jsx("p",{className:"text-gray-400",children:"Choose an event from the dropdown above to view its analytics"})]})}):S==="overview"?e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-8",children:[e.jsx("h3",{className:"text-xl mb-6 text-white",children:"Overview Analytics"}),$?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"Loading overview..."})]}):o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-gray-700 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"User Registration"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o.statistics.totalRegistrations})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Z,{className:"h-8 w-8 text-blue-400"})})]})}),o.privacySettings.showGuestDetails&&e.jsx("div",{className:"bg-gray-700 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Guest Registration"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o.statistics.totalGuests})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ae,{className:"h-8 w-8 text-purple-400"})})]})}),e.jsx("div",{className:"bg-gray-700 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total Registration"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:o.statistics.totalRegistrations+o.statistics.totalGuests})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(J,{className:"h-8 w-8 text-green-400"})})]})}),o.privacySettings.showPaymentAmounts&&e.jsx("div",{className:"bg-gray-700 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Total Collection"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:T(o.statistics.totalRevenue)})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx(re,{className:"h-8 w-8 text-orange-400"})})]})})]}),o.batchStats.batches.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Batch Participation Details"}),e.jsx("div",{className:"bg-gray-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Total Users"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Active Participants"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Participation Rate"}),o.privacySettings.showPaymentAmounts&&e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Total Collection"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-600",children:o.batchStats.batches.filter(s=>u==="all"||s.batch===parseInt(u)).map(s=>e.jsxs("tr",{className:"hover:bg-gray-600",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-white font-medium",children:["Batch ",s.batch]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300 text-center",children:s.statistics.uniqueUsers}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300 text-center",children:s.statistics.registrationCount}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300 text-center",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[s.statistics.uniqueUsers>0?(s.statistics.registrationCount/s.statistics.uniqueUsers*100).toFixed(1):"0.0","%"]})}),o.privacySettings.showPaymentAmounts&&e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300 text-center",children:["₹",s.statistics.totalRevenue.toLocaleString("en-IN")]})]},s.batch))})]})})})]}),o.privacySettings.showPaymentAmounts&&o.batchStats.batches.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-4",children:"Batch wise Revenue Sources"}),e.jsxs("div",{className:"bg-gray-700 rounded-lg p-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:o.batchStats.batches.slice(0,4).map(s=>{const a=s.statistics.totalRevenue-(s.statistics.totalDonations||0),l=s.statistics.totalDonations||0,m=Math.max(a,l);return e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm text-gray-300 mb-2",children:["Batch ",s.batch]}),e.jsxs("div",{className:"flex items-end justify-center space-x-2 h-32",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-8 bg-red-400 rounded-t",style:{height:m>0?`${l/m*100}px`:"4px",minHeight:"4px"}}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["₹",l.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-8 bg-green-400 rounded-t",style:{height:m>0?`${a/m*100}px`:"4px",minHeight:"4px"}}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["₹",a.toLocaleString("en-IN")]})]})]})]},s.batch)})}),e.jsxs("div",{className:"flex justify-center mt-6 space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-red-400 rounded mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Donations"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-green-400 rounded mr-2"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Registration Fees"})]})]})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-8",children:[e.jsx("h3",{className:"text-lg font-medium text-red-900 dark:text-red-200 mb-2",children:"Analytics Not Available"}),e.jsx("p",{className:"text-red-700 dark:text-red-300",children:"Public analytics are not available for this event or an error occurred."})]})})]}):e.jsx("div",{className:"bg-gray-800 rounded-2xl p-8",children:L?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"Loading registrations..."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-600",children:[e.jsx("th",{className:"text-left py-4 px-4 text-gray-300 font-medium",children:"Name"}),e.jsx(w,{field:"batch",className:"text-center",children:"Batch"}),e.jsx("th",{className:"text-center py-4 px-4 text-gray-300 font-medium",children:"Guest Count"}),x?.privacySettings.showDonationAmounts&&e.jsx("th",{className:"text-center py-4 px-4 text-gray-300 font-medium",children:"Donation"}),x?.privacySettings.showPaymentAmounts&&e.jsx(w,{field:"totalAmount",className:"text-center",children:"Total Amount"}),e.jsx(w,{field:"date",className:"text-center",children:"Date"})]})}),e.jsx("tbody",{children:x?.registrations&&x.registrations.length>0?O().filter(s=>u==="all"||s.user?.batch===parseInt(u)).map(s=>e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-700",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center",children:[s.user?.profileImage?e.jsx("img",{src:`http://localhost:3000/api/users/profile-picture/${s.user.id}`,alt:s.user?.fullName||"User",className:"w-10 h-10 rounded-full object-cover",onError:a=>{a.currentTarget.style.display="none";const l=a.currentTarget.nextElementSibling;l&&(l.style.display="flex")}}):null,e.jsx(Z,{className:"h-6 w-6 text-gray-400",style:{display:s.user?.profileImage?"none":"block"}})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:s.user?.fullName||"N/A"}),x.privacySettings.showUserEmails&&s.user?.email&&e.jsx("p",{className:"text-sm text-gray-400",children:s.user.email})]})]})}),e.jsx("td",{className:"py-4 px-4 text-center text-gray-300",children:s.user?.batch||"N/A"}),e.jsx("td",{className:"py-4 px-4 text-center text-gray-300",children:s.totalGuests||0}),x.privacySettings.showDonationAmounts&&e.jsx("td",{className:"py-4 px-4 text-center text-gray-300",children:T(s.donationAmount||0)}),x.privacySettings.showPaymentAmounts&&e.jsx("td",{className:"py-4 px-4 text-center text-gray-300",children:T(s.totalAmount||0)}),e.jsx("td",{className:"py-4 px-4 text-center text-gray-300",children:s.registrationDate?D(s.registrationDate):"N/A"})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"py-8 text-center text-gray-400",children:u!=="all"?"No registrations found for the selected batch":"No registrations available for public viewing"})})})]})})}),g!=="all"&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Privacy Notice:"})," This analytics view respects privacy settings configured by event administrators. Some information may be hidden based on these settings."]})})]})})},lt=()=>{const{user:g,auth:k}=Se(),[u]=be(),p=we(),S=ke(),[d,o]=n.useState("active"),[y,x]=n.useState(null),[i,$]=n.useState(null),[F,L]=n.useState(!1),[I,v]=n.useState(!1),[M,j]=n.useState(!1),[P,R]=n.useState(!1),[V,N]=n.useState(!1),[q,A]=n.useState(!1),[C,E]=n.useState(!1),[O,b]=n.useState(!1),[z,D]=n.useState(null),[T,w]=n.useState(null),[s,a]=n.useState(null),{data:l,isLoading:m,error:ie}=te({page:1,limit:50,upcoming:void 0}),{data:ne,isLoading:le,error:oe,refetch:K}=Re({page:1,limit:50}),Q=l?.events||[],G=ne?.registrations||[],U=new Date;n.useEffect(()=>{if(p.state?.activeTab&&["active","booked","past","analytics"].includes(p.state.activeTab)){o(p.state.activeTab),S(p.pathname,{replace:!0});return}const t=u.get("tab");t&&["active","booked","past","analytics"].includes(t)&&o(t)},[u,p.state,S,p.pathname]),n.useEffect(()=>{d==="booked"&&K()},[d,K]);const W=new Set(G.map(t=>t.event?.id).filter(Boolean));let B;d==="booked"?B=G.filter(t=>t.event).map(t=>({...t.event,registration:t,hasQRCode:!!t.qr,totalGuests:t.guests?.length||0,registrationStatus:t.status,paymentStatus:t.paymentStatus,mealPreference:t.mealPreference,registrationDate:t.createdAt,qrCode:t.qr})):B=Q.filter(t=>{const r=new Date(t.eventDate);return d==="active"?r>=U&&!["COMPLETED","CANCELLED"].includes(t.status):r<U||["COMPLETED","CANCELLED"].includes(t.status)});const ce=(t,r,c)=>{const f=new Date(t),h=Me(f,"MMM dd, yyyy");return r&&c?`${h} • ${r} - ${c}`:r?`${h} • ${r}`:h},de=t=>{switch(t){case"PUBLISHED":case"REGISTRATION_OPEN":return"bg-green-100 text-green-800";case"REGISTRATION_CLOSED":return"bg-yellow-100 text-yellow-800";case"COMPLETED":return"bg-gray-100 text-gray-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},X=t=>{x(t),L(!0)},xe=t=>{x(t),v(!0)},me=t=>{const r=G.find(c=>c.event?.id===t.id);r&&(x(t),$(r),j(!0))},ge=async()=>{if(i?.paymentTransaction?.id){E(!0),N(!0);try{const[t,r]=await Promise.all([fetch(`http://localhost:3000/api/payments/${i.paymentTransaction.id}/invoice`,{headers:{Authorization:`Bearer ${k.token||localStorage.getItem("token")}`}}),fetch("http://localhost:3000/api/organization",{headers:{Authorization:`Bearer ${k.token||localStorage.getItem("token")}`}})]);if(t.ok){const c=await t.json();let f={name:"Alumni Portal Organization",officialEmail:"admin@alumniportal.com",officeAddress:"Organization Address"};if(r.ok)try{const h=await r.json();h.data?.organization&&(f={name:h.data.organization.name||f.name,officialEmail:h.data.organization.officialEmail||f.officialEmail,officeAddress:h.data.organization.officeAddress||f.officeAddress,logoUrl:h.data.organization.logoUrl})}catch(h){console.warn("Failed to parse organization data:",h)}w({invoice:c.data.invoice,transaction:i.paymentTransaction,registration:i,user:g,organization:f})}else console.error("Failed to fetch invoice data"),alert("Failed to load invoice. Please try again."),N(!1)}catch(t){console.error("Error fetching invoice:",t),alert("Failed to load invoice. Please try again."),N(!1)}finally{E(!1)}}else i?.totalAmount===0?alert("This is a free event. No invoice is available."):alert("No payment transaction found for this registration.")},he=async()=>{if(i?.qr?.qrCode)D({qrCode:i.qr.qrCode,qrImageUrl:i.qr.qrImageUrl,event:{title:i.event.title,eventDate:i.event.eventDate,venue:i.event.venue},user:{fullName:g?.fullName||"User",email:g?.email||"user@example.com"},registrationId:i.id}),R(!0);else try{const t=`http://localhost:3000/api/events/${i.event.id}/my-registration/qr-code`,r=await fetch(t,{method:"GET",headers:{Authorization:`Bearer ${k.token||localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(r.ok){const c=await r.json(),f={qrCode:c.data?.qrCode||c.qrCode,qrImageUrl:c.data?.qrImageUrl||c.qrImageUrl,event:{title:i.event.title,eventDate:i.event.eventDate,venue:i.event.venue},user:{fullName:g?.fullName||"User",email:g?.email||"user@example.com"},registrationId:i.id};D(f),R(!0)}else{const c=await r.text();console.error("Failed to generate QR code:",r.status,c),alert(`Failed to generate QR code: ${r.status} - ${c}`)}}catch(t){console.error("Error generating QR code:",t),alert("Failed to generate QR code. Please try again.")}},ue=async()=>{if(i){b(!0),A(!0);try{const t=await fetch("http://localhost:3000/api/organization",{headers:{Authorization:`Bearer ${k.token||localStorage.getItem("token")}`}});let r={name:"Alumni Portal Organization"};if(t.ok)try{const c=await t.json();c.data?.organization&&(r={name:c.data.organization.name||r.name,logoUrl:c.data.organization.logoUrl})}catch(c){console.warn("Failed to parse organization data:",c)}a({registration:i,user:g,organization:r}),b(!1)}catch(t){console.error("Error loading ticket:",t),b(!1),alert("Failed to load ticket.")}}},H=()=>{x(null),$(null),D(null),w(null),a(null),L(!1),v(!1),j(!1),R(!1),N(!1),A(!1),E(!1),b(!1)},pe=()=>{D(null),R(!1)},fe=()=>{w(null),N(!1),E(!1)},ye=()=>{a(null),A(!1),b(!1)},ve=m||d==="booked"&&le,je=ie||d==="booked"&&oe;return ve?e.jsx(se,{}):je?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-red-500 mb-4",children:"Failed to load events"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn-guild",children:"Try Again"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Events"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Discover and participate in alumni events"})]})}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsxs("button",{onClick:()=>o("active"),className:`py-2 px-1 border-b-2 font-medium text-sm ${d==="active"?"border-guild-500 text-guild-600 dark:text-guild-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["Active Events",e.jsx("span",{className:"ml-2 bg-guild-100 text-guild-600 py-0.5 px-2 rounded-full text-xs",children:Q.filter(t=>new Date(t.eventDate)>=U&&!["COMPLETED","CANCELLED"].includes(t.status)).length})]}),e.jsx("button",{onClick:()=>o("booked"),className:`py-2 px-1 border-b-2 font-medium text-sm ${d==="booked"?"border-guild-500 text-guild-600 dark:text-guild-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:"Your Bookings"}),e.jsxs("button",{onClick:()=>o("past"),className:`py-2 px-1 border-b-2 font-medium text-sm ${d==="past"?"border-guild-500 text-guild-600 dark:text-guild-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:["Past Events",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs",children:Q.filter(t=>new Date(t.eventDate)<U||["COMPLETED","CANCELLED"].includes(t.status)).length})]}),e.jsxs("button",{onClick:()=>o("analytics"),className:`py-2 px-1 border-b-2 font-medium text-sm ${d==="analytics"?"border-guild-500 text-guild-600 dark:text-guild-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"}`,children:[e.jsx(J,{className:"h-4 w-4 inline mr-1"}),"Analytics"]})]})}),d==="analytics"?e.jsx(Pe,{}):B.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:["No ",d==="booked"?"booked":d," events"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:d==="active"?"There are no upcoming events at the moment.":d==="booked"?"You haven't registered for any events yet.":"No past events to display."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:B.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow rounded-lg hover:shadow-lg transition-shadow duration-200",children:[t.heroImage&&e.jsx("div",{className:"aspect-w-16 aspect-h-9",children:e.jsx("img",{src:`http://localhost:3000/api/events/${t.id}/hero-image`,alt:t.title,className:"w-full h-48 object-cover",onError:r=>{r.target.style.display="none"}})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.category&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",children:t.category.name}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${de(t.status)}`,children:t.status.replace("_"," ")})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{className:"flex-shrink-0 mr-2 h-4 w-4"}),ce(t.eventDate,t.startTime,t.endTime)]}),e.jsx("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:t.eventMode==="VIRTUAL"?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"flex-shrink-0 mr-2 h-4 w-4"}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:"Virtual Event"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"flex-shrink-0 mr-2 h-4 w-4"}),e.jsx("span",{className:"truncate",children:t.venue||"Venue TBA"}),t.eventMode==="HYBRID"&&e.jsx("span",{className:"ml-2 px-2 py-1 rounded-full text-xs bg-purple-100 text-purple-800",children:"Hybrid"})]})}),t.maxCapacity&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(ae,{className:"flex-shrink-0 mr-2 h-4 w-4"}),t._count?.registrations||t.registrationCount||0," / ",t.maxCapacity," registered"]}),Number(t.registrationFee)>0&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(re,{className:"flex-shrink-0 mr-2 h-4 w-4"}),"₹",t.registrationFee,Number(t.guestFee)>0&&e.jsxs("span",{className:"text-xs ml-1",children:["(Guest: ₹",t.guestFee,")"]})]})]}),e.jsx("div",{className:"mt-4 space-y-2",children:d==="active"?e.jsxs(e.Fragment,{children:[["PUBLISHED","REGISTRATION_OPEN"].includes(t.status)&&!W.has(t.id)&&e.jsx("button",{className:"w-full btn-guild text-sm",onClick:()=>xe(t),children:"Register Now"}),W.has(t.id)&&e.jsx("div",{className:"w-full text-center py-2 bg-green-100 text-green-800 rounded-md text-sm font-medium",children:"✓ Already Registered"}),e.jsxs("button",{className:"w-full btn-secondary text-sm inline-flex items-center justify-center",onClick:()=>X(t),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"View Details"]})]}):d==="booked"?e.jsxs("button",{className:"w-full btn-guild text-sm inline-flex items-center justify-center",onClick:()=>me(t),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"View Registration Details"]}):e.jsxs("button",{className:"w-full btn-secondary text-sm inline-flex items-center justify-center",onClick:()=>X(t),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"View Event"]})})]})]},t.id))}),e.jsx(Ee,{event:y,isOpen:F,onClose:H}),e.jsx(De,{event:y,isOpen:I,onClose:H}),e.jsx(Ae,{registration:i,isOpen:M,onClose:H,onViewInvoice:ge,onViewQR:he,onViewTicket:ue,isLoadingInvoice:C,isLoadingTicket:O}),e.jsx(Ce,{isOpen:P,onClose:pe,qrData:z}),e.jsx(Te,{isOpen:V,onClose:fe,isLoading:C,invoiceData:T}),e.jsx($e,{isOpen:q,onClose:ye,ticketData:s,isLoading:O})]})};export{lt as default};
//# sourceMappingURL=Events-DDLNpN8n.js.map
